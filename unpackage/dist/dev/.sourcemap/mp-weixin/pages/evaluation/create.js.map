{"version":3,"file":"create.js","sources":["pages/evaluation/create.vue","D:/Users/windows/Downloads/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZXZhbHVhdGlvbi9jcmVhdGUudnVl"],"sourcesContent":["<template>\r\n  <view class=\"evaluation-container\">\r\n    <!-- 顶部导航栏 -->\r\n    <view class=\"nav-bar\">\r\n      <view class=\"nav-back\" @click=\"goBack\">\r\n        <text class=\"iconfont\">‹</text>\r\n      </view>\r\n      <view class=\"nav-title\">评价订单</view>\r\n      <view class=\"nav-placeholder\"></view>\r\n    </view>\r\n\r\n    <!-- 评价内容 -->\r\n    <scroll-view class=\"evaluation-content\" scroll-y>\r\n      <!-- 订单信息 -->\r\n      <view class=\"order-info\" v-if=\"orderInfo\">\r\n        <view class=\"info-title\">订单信息</view>\r\n        <view class=\"info-detail\">\r\n          <text class=\"order-no\">订单号: {{ orderInfo.orderNo || '-' }}</text>\r\n          <text class=\"service-type\">服务类型: {{ getServiceTypeName(orderInfo.serviceType) }}</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 骑手信息 -->\r\n      <view class=\"rider-info\" v-if=\"riderInfo\">\r\n        <view class=\"rider-avatar\">\r\n          <text>{{ riderInfo.realName ? riderInfo.realName.substring(0, 1) : '骑' }}</text>\r\n        </view>\r\n        <view class=\"rider-detail\">\r\n          <text class=\"rider-name\">{{ riderInfo.realName || '骑手' }}</text>\r\n          <text class=\"rider-label\">为您服务</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 评分区域 -->\r\n      <view class=\"rating-section\">\r\n        <view class=\"section-title\">评分</view>\r\n        <view class=\"rating-stars\">\r\n          <view\r\n            class=\"star-item\"\r\n            v-for=\"(star, index) in 5\"\r\n            :key=\"index\"\r\n            @click=\"selectStar(index + 1)\"\r\n          >\r\n            <text class=\"star-icon\">{{ index < rating ? '★' : '☆' }}</text>\r\n          </view>\r\n        </view>\r\n        <view class=\"rating-text\">{{ getRatingText() }}</view>\r\n      </view>\r\n\r\n      <!-- 评价标签 -->\r\n      <view class=\"tags-section\">\r\n        <view class=\"section-title\">评价标签</view>\r\n        <view class=\"tags-list\">\r\n          <view\r\n            class=\"tag-item\"\r\n            v-for=\"(tag, index) in evaluationTags\"\r\n            :key=\"index\"\r\n            :class=\"{ active: selectedTags.includes(tag) }\"\r\n            @click=\"toggleTag(tag)\"\r\n          >\r\n            {{ tag }}\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 文字评价 -->\r\n      <view class=\"comment-section\">\r\n        <view class=\"section-title\">详细评价</view>\r\n        <textarea\r\n          class=\"comment-input\"\r\n          v-model=\"comment\"\r\n          placeholder=\"请输入您的评价内容...\"\r\n          maxlength=\"200\"\r\n          :show-confirm-bar=\"false\"\r\n        ></textarea>\r\n        <view class=\"comment-count\">{{ comment.length }}/200</view>\r\n      </view>\r\n    </scroll-view>\r\n\r\n    <!-- 底部提交栏 -->\r\n    <view class=\"bottom-bar\">\r\n      <button class=\"btn-submit\" @click=\"submitEvaluation\" :disabled=\"!canSubmit\">\r\n        提交评价\r\n      </button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { getOrderDetail } from '@/api/order.js'\r\nimport { submitEvaluation } from '@/api/order.js'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      orderId: null,\r\n      orderInfo: null,\r\n      riderInfo: null,\r\n      rating: 5, // 默认5星\r\n      comment: '',\r\n      selectedTags: [],\r\n      evaluationTags: [\r\n        '配送速度快',\r\n        '服务态度好',\r\n        '物品完好',\r\n        '沟通顺畅',\r\n        '准时送达',\r\n        '包装仔细',\r\n        '值得信赖',\r\n        '下次还会找你'\r\n      ]\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    canSubmit() {\r\n      return this.rating > 0 && this.comment.trim().length > 0\r\n    }\r\n  },\r\n\r\n  onLoad(options) {\r\n    if (options.orderId) {\r\n      this.orderId = options.orderId\r\n      this.loadOrderDetail()\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    /**\r\n     * 加载订单详情\r\n     */\r\n    async loadOrderDetail() {\r\n      try {\r\n        uni.showLoading({ title: '加载中...' })\r\n\r\n        const res = await getOrderDetail(this.orderId)\r\n\r\n        uni.hideLoading()\r\n\r\n        if (res.code === 200 && res.data) {\r\n          this.orderInfo = res.data\r\n          // 如果有骑手信息\r\n          if (res.data.runnerInfo) {\r\n            this.riderInfo = res.data.runnerInfo\r\n          }\r\n          console.log('✅ 订单详情加载成功:', this.orderInfo)\r\n        } else {\r\n          uni.showToast({\r\n            title: res.message || '加载失败',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      } catch (error) {\r\n        uni.hideLoading()\r\n        console.error('❌ 加载订单详情失败:', error)\r\n        uni.showToast({\r\n          title: '加载失败，请稍后重试',\r\n          icon: 'none'\r\n        })\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 选择评分\r\n     */\r\n    selectStar(star) {\r\n      this.rating = star\r\n    },\r\n\r\n    /**\r\n     * 获取评分文字\r\n     */\r\n    getRatingText() {\r\n      const texts = {\r\n        1: '非常不满意',\r\n        2: '不满意',\r\n        3: '一般',\r\n        4: '满意',\r\n        5: '非常满意'\r\n      }\r\n      return texts[this.rating] || ''\r\n    },\r\n\r\n    /**\r\n     * 切换标签\r\n     */\r\n    toggleTag(tag) {\r\n      const index = this.selectedTags.indexOf(tag)\r\n      if (index > -1) {\r\n        this.selectedTags.splice(index, 1)\r\n      } else {\r\n        if (this.selectedTags.length < 5) {\r\n          this.selectedTags.push(tag)\r\n        } else {\r\n          uni.showToast({\r\n            title: '最多选择5个标签',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 获取服务类型名称\r\n     */\r\n    getServiceTypeName(type) {\r\n      const types = {\r\n        1: '帮我买',\r\n        2: '帮我送',\r\n        3: '帮我取',\r\n        4: '全能'\r\n      }\r\n      return types[type] || '-'\r\n    },\r\n\r\n    /**\r\n     * 提交评价\r\n     */\r\n    async submitEvaluation() {\r\n      if (!this.canSubmit) {\r\n        uni.showToast({\r\n          title: '请完善评价内容',\r\n          icon: 'none'\r\n        })\r\n        return\r\n      }\r\n\r\n      try {\r\n        uni.showLoading({ title: '提交中...' })\r\n\r\n        // 将标签拼接到评价内容中\r\n        let feedback = this.comment.trim()\r\n        if (this.selectedTags.length > 0) {\r\n          feedback = `[${this.selectedTags.join(', ')}] ${feedback}`\r\n        }\r\n\r\n        const data = {\r\n          orderId: Number(this.orderId),\r\n          rating: this.rating,\r\n          feedback: feedback,\r\n          evaluationImgs: [],\r\n          anonymous: false\r\n        }\r\n\r\n        console.log('提交评价数据:', data)\r\n\r\n        const res = await submitEvaluation(data)\r\n\r\n        uni.hideLoading()\r\n\r\n        if (res.code === 200) {\r\n          uni.showToast({\r\n            title: '评价成功',\r\n            icon: 'success'\r\n          })\r\n\r\n          // 延迟跳转到评价详情页\r\n          setTimeout(() => {\r\n            uni.redirectTo({\r\n              url: `/pages/evaluation/detail?orderId=${this.orderId}`\r\n            })\r\n          }, 1500)\r\n        } else {\r\n          uni.showToast({\r\n            title: res.message || '提交失败',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      } catch (error) {\r\n        uni.hideLoading()\r\n        console.error('❌ 提交评价失败:', error)\r\n        uni.showToast({\r\n          title: '提交失败，请稍后重试',\r\n          icon: 'none'\r\n        })\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 返回上一页\r\n     */\r\n    goBack() {\r\n      uni.navigateBack()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.evaluation-container {\r\n  min-height: 100vh;\r\n  background-color: #f5f5f5;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n/* 导航栏 */\r\n.nav-bar {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  height: 44px;\r\n  padding: 0 15px;\r\n  background-color: #fff;\r\n  border-bottom: 1px solid #eee;\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  z-index: 100;\r\n}\r\n\r\n.nav-back,\r\n.nav-placeholder {\r\n  width: 40px;\r\n  height: 40px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 24px;\r\n  color: #333;\r\n  cursor: pointer;\r\n}\r\n\r\n.nav-title {\r\n  font-size: 17px;\r\n  font-weight: 600;\r\n  color: #333;\r\n}\r\n\r\n/* 评价内容 */\r\n.evaluation-content {\r\n  flex: 1;\r\n  margin-top: 54px;\r\n  margin-bottom: 80px;\r\n  padding: 15px;\r\n  overflow-y: auto;\r\n}\r\n\r\n/* 订单信息 */\r\n.order-info {\r\n  background-color: #fff;\r\n  border-radius: 12px;\r\n  padding: 20px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.info-title {\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  color: #333;\r\n  margin-bottom: 12px;\r\n}\r\n\r\n.info-detail {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n}\r\n\r\n.order-no,\r\n.service-type {\r\n  font-size: 14px;\r\n  color: #666;\r\n}\r\n\r\n/* 骑手信息 */\r\n.rider-info {\r\n  background-color: #fff;\r\n  border-radius: 12px;\r\n  padding: 20px;\r\n  margin-bottom: 15px;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.rider-avatar {\r\n  width: 60px;\r\n  height: 60px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  border-radius: 50%;\r\n  color: #fff;\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n  margin-right: 15px;\r\n}\r\n\r\n.rider-detail {\r\n  flex: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.rider-name {\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  color: #333;\r\n  margin-bottom: 6px;\r\n}\r\n\r\n.rider-label {\r\n  font-size: 13px;\r\n  color: #999;\r\n}\r\n\r\n/* 评分区域 */\r\n.rating-section {\r\n  background-color: #fff;\r\n  border-radius: 12px;\r\n  padding: 20px;\r\n  margin-bottom: 15px;\r\n  text-align: center;\r\n}\r\n\r\n.section-title {\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  color: #333;\r\n  margin-bottom: 15px;\r\n  text-align: left;\r\n}\r\n\r\n.rating-stars {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 12px;\r\n  margin-bottom: 12px;\r\n}\r\n\r\n.star-item {\r\n  cursor: pointer;\r\n  transition: transform 0.2s;\r\n}\r\n\r\n.star-item:active {\r\n  transform: scale(1.2);\r\n}\r\n\r\n.star-icon {\r\n  font-size: 48px;\r\n  color: #ffd700;\r\n}\r\n\r\n.rating-text {\r\n  font-size: 14px;\r\n  color: #667eea;\r\n  font-weight: 600;\r\n}\r\n\r\n/* 评价标签 */\r\n.tags-section {\r\n  background-color: #fff;\r\n  border-radius: 12px;\r\n  padding: 20px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.tags-list {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 12px;\r\n}\r\n\r\n.tag-item {\r\n  padding: 10px 18px;\r\n  background-color: #f5f5f5;\r\n  border-radius: 20px;\r\n  font-size: 14px;\r\n  color: #666;\r\n  cursor: pointer;\r\n  transition: all 0.3s;\r\n  border: 2px solid transparent;\r\n}\r\n\r\n.tag-item.active {\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  color: #fff;\r\n  border-color: #667eea;\r\n  transform: scale(1.05);\r\n}\r\n\r\n/* 文字评价 */\r\n.comment-section {\r\n  background-color: #fff;\r\n  border-radius: 12px;\r\n  padding: 20px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.comment-input {\r\n  width: 100%;\r\n  min-height: 120px;\r\n  padding: 12px;\r\n  font-size: 14px;\r\n  color: #333;\r\n  background-color: #f5f5f5;\r\n  border-radius: 8px;\r\n  border: none;\r\n  resize: none;\r\n  line-height: 1.6;\r\n}\r\n\r\n.comment-count {\r\n  text-align: right;\r\n  font-size: 12px;\r\n  color: #999;\r\n  margin-top: 8px;\r\n}\r\n\r\n/* 底部提交栏 */\r\n.bottom-bar {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  padding: 15px;\r\n  background-color: #fff;\r\n  border-top: 1px solid #eee;\r\n  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.btn-submit {\r\n  width: 100%;\r\n  height: 48px;\r\n  line-height: 48px;\r\n  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n  color: #fff;\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  border-radius: 24px;\r\n  border: none;\r\n}\r\n\r\n.btn-submit[disabled] {\r\n  background: #ccc;\r\n  color: #999;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/Delivery Service Platform/uniapp/pages/evaluation/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getOrderDetail","submitEvaluation"],"mappings":"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"}