{"version":3,"file":"edit.js","sources":["pages/address/edit.vue","D:/Users/windows/Downloads/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRkcmVzcy9lZGl0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"address-edit-container\">\r\n    <!-- 顶部导航栏 -->\r\n    <view class=\"nav-bar\">\r\n      <view class=\"nav-back\" @click=\"goBack\">\r\n        <text class=\"iconfont\">‹</text>\r\n      </view>\r\n      <view class=\"nav-title\">{{ isEdit ? '编辑地址' : '添加地址' }}</view>\r\n      <view class=\"nav-save\" @click=\"saveAddress\">\r\n        <text>保存</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 表单内容 -->\r\n    <view class=\"form-content\">\r\n      <!-- 联系人 -->\r\n      <view class=\"form-item\">\r\n        <view class=\"form-label required\">联系人</view>\r\n        <input\r\n          class=\"form-input\"\r\n          v-model=\"formData.contactName\"\r\n          placeholder=\"请输入联系人姓名\"\r\n          maxlength=\"20\"\r\n        />\r\n      </view>\r\n\r\n      <!-- 联系电话 -->\r\n      <view class=\"form-item\">\r\n        <view class=\"form-label required\">联系电话</view>\r\n        <input\r\n          class=\"form-input\"\r\n          v-model=\"formData.contactPhone\"\r\n          placeholder=\"请输入联系电话\"\r\n          type=\"number\"\r\n          maxlength=\"11\"\r\n        />\r\n      </view>\r\n\r\n      <!-- 省市区选择 -->\r\n      <view class=\"form-item\">\r\n        <view class=\"form-label required\">所在地区</view>\r\n        <view class=\"form-picker\" @click=\"showRegionPicker = true\">\r\n          <text class=\"picker-text\" v-if=\"regionText\">{{ regionText }}</text>\r\n          <text class=\"picker-placeholder\" v-else>请选择省/市/区</text>\r\n          <text class=\"picker-arrow\">›</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 详细地址 -->\r\n      <view class=\"form-item\">\r\n        <view class=\"form-label required\">详细地址</view>\r\n        <textarea\r\n          class=\"form-textarea\"\r\n          v-model=\"formData.detailAddress\"\r\n          placeholder=\"请输入详细地址，如街道、楼栋、门牌号等\"\r\n          maxlength=\"200\"\r\n          :show-confirm-bar=\"false\"\r\n        />\r\n      </view>\r\n\r\n      <!-- 设为默认地址 -->\r\n      <view class=\"form-item form-switch\">\r\n        <view class=\"switch-label\">\r\n          <text class=\"switch-icon\">⭐</text>\r\n          <text class=\"switch-text\">设为默认地址</text>\r\n        </view>\r\n        <switch\r\n          :checked=\"formData.isDefault === 1\"\r\n          @change=\"onDefaultChange\"\r\n          color=\"#667eea\"\r\n        />\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 省市区选择器 -->\r\n    <picker\r\n      mode=\"region\"\r\n      :value=\"regionValue\"\r\n      @change=\"onRegionChange\"\r\n      v-if=\"showRegionPicker\"\r\n    >\r\n      <view></view>\r\n    </picker>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { getAddressDetail, saveAddress } from '@/api/address.js'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      isEdit: false, // 是否是编辑模式\r\n      addressId: null, // 地址ID（编辑模式）\r\n      showRegionPicker: false,\r\n      regionValue: [], // 省市区数组\r\n      regionText: '', // 省市区文本\r\n      formData: {\r\n        contactName: '',\r\n        contactPhone: '',\r\n        province: '',\r\n        city: '',\r\n        district: '',\r\n        detailAddress: '',\r\n        isDefault: 0,\r\n        latitude: null,\r\n        longitude: null\r\n      }\r\n    }\r\n  },\r\n\r\n  onLoad(options) {\r\n    // 判断是否是编辑模式\r\n    if (options.id) {\r\n      this.isEdit = true\r\n      this.addressId = options.id\r\n      this.loadAddressDetail()\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    /**\r\n     * 加载地址详情（编辑模式）\r\n     */\r\n    async loadAddressDetail() {\r\n      try {\r\n        uni.showLoading({ title: '加载中...' })\r\n\r\n        const res = await getAddressDetail(this.addressId)\r\n\r\n        uni.hideLoading()\r\n\r\n        if (res.code === 200 && res.data) {\r\n          const data = res.data\r\n          this.formData = {\r\n            contactName: data.contactName || '',\r\n            contactPhone: data.contactPhone || '',\r\n            province: data.province || '',\r\n            city: data.city || '',\r\n            district: data.district || '',\r\n            detailAddress: data.detailAddress || '',\r\n            isDefault: data.isDefault || 0,\r\n            latitude: data.latitude,\r\n            longitude: data.longitude\r\n          }\r\n\r\n          // 设置省市区\r\n          if (data.province && data.city && data.district) {\r\n            this.regionValue = [data.province, data.city, data.district]\r\n            this.regionText = `${data.province} ${data.city} ${data.district}`\r\n          }\r\n\r\n          console.log('✅ 地址详情加载成功:', this.formData)\r\n        } else {\r\n          uni.showToast({\r\n            title: '加载失败',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      } catch (error) {\r\n        uni.hideLoading()\r\n        console.error('❌ 加载地址详情失败:', error)\r\n        uni.showToast({\r\n          title: '加载失败，请稍后重试',\r\n          icon: 'none'\r\n        })\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 省市区选择改变\r\n     */\r\n    onRegionChange(e) {\r\n      const value = e.detail.value\r\n      this.regionValue = value\r\n      this.regionText = value.join(' ')\r\n      this.formData.province = value[0]\r\n      this.formData.city = value[1]\r\n      this.formData.district = value[2]\r\n      this.showRegionPicker = false\r\n    },\r\n\r\n    /**\r\n     * 默认地址开关改变\r\n     */\r\n    onDefaultChange(e) {\r\n      this.formData.isDefault = e.detail.value ? 1 : 0\r\n    },\r\n\r\n    /**\r\n     * 表单验证\r\n     */\r\n    validateForm() {\r\n      if (!this.formData.contactName.trim()) {\r\n        uni.showToast({\r\n          title: '请输入联系人姓名',\r\n          icon: 'none'\r\n        })\r\n        return false\r\n      }\r\n\r\n      if (!this.formData.contactPhone.trim()) {\r\n        uni.showToast({\r\n          title: '请输入联系电话',\r\n          icon: 'none'\r\n        })\r\n        return false\r\n      }\r\n\r\n      // 验证手机号格式\r\n      const phoneReg = /^1[3-9]\\d{9}$/\r\n      if (!phoneReg.test(this.formData.contactPhone)) {\r\n        uni.showToast({\r\n          title: '请输入正确的手机号',\r\n          icon: 'none'\r\n        })\r\n        return false\r\n      }\r\n\r\n      if (!this.formData.province || !this.formData.city || !this.formData.district) {\r\n        uni.showToast({\r\n          title: '请选择所在地区',\r\n          icon: 'none'\r\n        })\r\n        return false\r\n      }\r\n\r\n      if (!this.formData.detailAddress.trim()) {\r\n        uni.showToast({\r\n          title: '请输入详细地址',\r\n          icon: 'none'\r\n        })\r\n        return false\r\n      }\r\n\r\n      return true\r\n    },\r\n\r\n    /**\r\n     * 保存地址\r\n     */\r\n    async saveAddress() {\r\n      // 表单验证\r\n      if (!this.validateForm()) {\r\n        return\r\n      }\r\n\r\n      try {\r\n        uni.showLoading({ title: '保存中...' })\r\n\r\n        // 构造请求数据\r\n        const requestData = {\r\n          ...this.formData\r\n        }\r\n\r\n        // 编辑模式需要传ID\r\n        if (this.isEdit && this.addressId) {\r\n          requestData.id = this.addressId\r\n        }\r\n\r\n        const res = await saveAddress(requestData)\r\n\r\n        uni.hideLoading()\r\n\r\n        if (res.code === 200) {\r\n          uni.showToast({\r\n            title: this.isEdit ? '修改成功' : '添加成功',\r\n            icon: 'success',\r\n            duration: 1500\r\n          })\r\n\r\n          // 延迟返回上一页\r\n          setTimeout(() => {\r\n            uni.navigateBack()\r\n          }, 1500)\r\n        } else {\r\n          uni.showToast({\r\n            title: res.message || '保存失败',\r\n            icon: 'none'\r\n          })\r\n        }\r\n      } catch (error) {\r\n        uni.hideLoading()\r\n        console.error('❌ 保存地址失败:', error)\r\n        uni.showToast({\r\n          title: '保存失败，请稍后重试',\r\n          icon: 'none'\r\n        })\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 返回上一页\r\n     */\r\n    goBack() {\r\n      uni.navigateBack()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.address-edit-container {\r\n  min-height: 100vh;\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n/* 导航栏 */\r\n.nav-bar {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  height: 44px;\r\n  padding: 0 15px;\r\n  background-color: #fff;\r\n  border-bottom: 1px solid #eee;\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  z-index: 100;\r\n}\r\n\r\n.nav-back,\r\n.nav-save {\r\n  width: 50px;\r\n  height: 40px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 15px;\r\n  cursor: pointer;\r\n}\r\n\r\n.nav-back {\r\n  font-size: 24px;\r\n  color: #333;\r\n}\r\n\r\n.nav-save {\r\n  color: #667eea;\r\n  font-weight: 600;\r\n  justify-content: flex-end;\r\n}\r\n\r\n.nav-title {\r\n  font-size: 17px;\r\n  font-weight: 600;\r\n  color: #333;\r\n}\r\n\r\n/* 表单内容 */\r\n.form-content {\r\n  margin-top: 54px;\r\n  padding: 10px 15px;\r\n}\r\n\r\n.form-item {\r\n  background-color: #fff;\r\n  border-radius: 8px;\r\n  padding: 15px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.form-label {\r\n  font-size: 14px;\r\n  color: #333;\r\n  margin-bottom: 10px;\r\n  font-weight: 500;\r\n}\r\n\r\n.form-label.required::before {\r\n  content: '*';\r\n  color: #ff4d4f;\r\n  margin-right: 4px;\r\n}\r\n\r\n.form-input {\r\n  width: 100%;\r\n  height: 40px;\r\n  font-size: 15px;\r\n  color: #333;\r\n}\r\n\r\n.form-textarea {\r\n  width: 100%;\r\n  min-height: 80px;\r\n  font-size: 15px;\r\n  color: #333;\r\n  line-height: 1.6;\r\n  padding: 5px 0;\r\n}\r\n\r\n/* 选择器 */\r\n.form-picker {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  height: 40px;\r\n}\r\n\r\n.picker-text {\r\n  font-size: 15px;\r\n  color: #333;\r\n}\r\n\r\n.picker-placeholder {\r\n  font-size: 15px;\r\n  color: #999;\r\n}\r\n\r\n.picker-arrow {\r\n  font-size: 20px;\r\n  color: #999;\r\n}\r\n\r\n/* 开关 */\r\n.form-switch {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n}\r\n\r\n.switch-label {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.switch-icon {\r\n  font-size: 18px;\r\n  margin-right: 8px;\r\n}\r\n\r\n.switch-text {\r\n  font-size: 15px;\r\n  color: #333;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/Delivery Service Platform/uniapp/pages/address/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getAddressDetail","saveAddress"],"mappings":"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"}