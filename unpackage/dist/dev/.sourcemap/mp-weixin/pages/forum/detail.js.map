{"version":3,"file":"detail.js","sources":["pages/forum/detail.vue","D:/Users/windows/Downloads/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZm9ydW0vZGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"detail-container\">\r\n    <view class=\"status-bar\"></view>\r\n    <view class=\"nav-bar\">\r\n      <view class=\"nav-back\" @tap=\"goBack\">\r\n        <text class=\"iconfont\">‚Äπ</text>\r\n      </view>\r\n      <view class=\"nav-title\">ËØ¶ÊÉÖ</view>\r\n      <view class=\"nav-right\"></view>\r\n    </view>\r\n\r\n    <scroll-view class=\"detail-scroll\" scroll-y>\r\n      <!-- Â∏ñÂ≠êÂÜÖÂÆπ -->\r\n      <view class=\"post-pannel\" v-if=\"post\">\r\n        <view class=\"user-row\">\r\n          <image class=\"avatar\" :src=\"post.avatar || '/static/images/default-avatar.png'\"></image>\r\n          <view class=\"info\">\r\n            <view class=\"name-box\">\r\n              <text class=\"nickname\">{{ post.nickname }}</text>\r\n              <text v-if=\"post.tag\" class=\"tag\">{{ post.tag }}</text>\r\n            </view>\r\n            <text class=\"time\">{{ post.createTime }}</text>\r\n          </view>\r\n          <button v-if=\"isMe\" class=\"del-btn\" @tap=\"onDeletePost\">Âà†Èô§</button>\r\n        </view>\r\n        \r\n        <view class=\"content\">\r\n          <text v-if=\"post.title\" class=\"title\">{{ post.title }}</text>\r\n          <text class=\"text\">{{ post.content }}</text>\r\n          <view class=\"image-grid\">\r\n            <image \r\n              v-for=\"(img, idx) in post.images\" \r\n              :key=\"idx\" \r\n              :src=\"img\" \r\n              class=\"detail-img\" \r\n              mode=\"widthFix\"\r\n              @tap=\"previewImage(idx)\"\r\n            ></image>\r\n          </view>\r\n        </view>\r\n\r\n        <view class=\"interact-bar\">\r\n          <view class=\"item\" :class=\"{active: post.liked}\" @tap=\"onLike\">\r\n            <text class=\"icon\">{{ post.liked ? '‚ù§Ô∏è' : 'ü§ç' }}</text>\r\n            <text class=\"num\">{{ post.likeCount || 0 }} ‰∫∫ËßâÂæóÂæàËµû</text>\r\n          </view>\r\n          <view class=\"view-info\">{{ post.viewCount || 0 }} Ê¨°ÈòÖËØª</view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- ËØÑËÆ∫Âå∫Âüü -->\r\n      <view class=\"comment-section\">\r\n        <view class=\"section-title\">ËØÑËÆ∫ ({{ comments.length }})</view>\r\n        \r\n        <view class=\"comment-list\">\r\n          <view class=\"comment-item\" v-for=\"comment in comments\" :key=\"comment.id\">\r\n            <image class=\"c-avatar\" :src=\"comment.avatar || '/static/images/default-avatar.png'\"></image>\r\n            <view class=\"c-body\">\r\n              <view class=\"c-header\">\r\n                <text class=\"c-nickname\">{{ comment.nickname }}</text>\r\n                <text class=\"c-time\">{{ comment.createTime }}</text>\r\n              </view>\r\n              <text class=\"c-text\">{{ comment.content }}</text>\r\n              <view v-if=\"comment.isMe\" class=\"c-delete\" @tap=\"onDeleteComment(comment.id)\">Âà†Èô§</view>\r\n            </view>\r\n          </view>\r\n          \r\n          <view v-if=\"comments.length === 0\" class=\"no-comment\">\r\n            ËøòÊ≤°ÊúâËØÑËÆ∫ÔºåÂø´Êù•Êä¢Ê≤ôÂèë~\r\n          </view>\r\n        </view>\r\n      </view>\r\n      \r\n      <!-- Â∫ïÈÉ®ÊíëÂºÄ -->\r\n      <view class=\"bottom-padding\"></view>\r\n    </scroll-view>\r\n\r\n    <!-- Â∫ïÈÉ®ËæìÂÖ•Ê°Ü -->\r\n    <view class=\"comment-input-bar\">\r\n      <input \r\n        class=\"c-input\" \r\n        v-model=\"commentValue\" \r\n        placeholder=\"ÂÜô‰∏ã‰Ω†ÁöÑÁÉ≠ËØÑ...\" \r\n        confirm-type=\"send\"\r\n        @confirm=\"submitComment\"\r\n      />\r\n      <text class=\"send-btn\" :class=\"{active: commentValue.trim()}\" @tap=\"submitComment\">ÂèëÈÄÅ</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { getPostDetail, likePost, deletePost, addComment, getCommentList, deleteComment } from '@/api/forum.js'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      id: null,\r\n      post: null,\r\n      comments: [],\r\n      commentValue: '',\r\n      isMe: false\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    this.id = options.id\r\n    this.loadData()\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      uni.navigateBack()\r\n    },\r\n    async loadData() {\r\n      uni.showLoading({ title: 'Âä†ËΩΩ‰∏≠' })\r\n      try {\r\n        const [pRes, cRes] = await Promise.all([\r\n          getPostDetail(this.id),\r\n          getCommentList({ postId: this.id, page: 1, size: 50 })\r\n        ])\r\n        \r\n        console.log('üîç Â∏ñÂ≠êËØ¶ÊÉÖÂìçÂ∫î:', pRes)\r\n        console.log('üîç ËØÑËÆ∫ÂàóË°®ÂìçÂ∫î:', cRes)\r\n        \r\n        if (pRes.code === 200) {\r\n          this.post = pRes.data\r\n          this.isMe = this.post.isOwner // ‰ΩøÁî®ÂêéÁ´ØËøîÂõûÁöÑ isOwner\r\n          \r\n          // Ëß£ÊûêÂõæÁâá JSON Â≠óÁ¨¶‰∏≤\r\n          if (this.post.images && typeof this.post.images === 'string') {\r\n            try {\r\n              this.post.images = JSON.parse(this.post.images)\r\n            } catch (e) {\r\n              console.error('Ëß£ÊûêËØ¶ÊÉÖÂõæÁâáÂ§±Ë¥•:', e)\r\n              this.post.images = []\r\n            }\r\n          }\r\n        }\r\n        \r\n        if (cRes.code === 200) {\r\n          this.comments = cRes.data.records || []\r\n        }\r\n      } catch (e) {\r\n        console.error('‚ùå Âä†ËΩΩËØ¶ÊÉÖÂ§±Ë¥•:', e)\r\n        uni.showToast({ title: 'Âä†ËΩΩÂ§±Ë¥•', icon: 'none' })\r\n      } finally {\r\n        uni.hideLoading()\r\n      }\r\n    },\r\n    async onLike() {\r\n      try {\r\n        const res = await likePost(this.id)\r\n        if (res.code === 200) {\r\n          this.post.liked = res.data.liked\r\n          this.post.likeCount = res.data.likeCount\r\n        }\r\n      } catch (e) {}\r\n    },\r\n    async submitComment() {\r\n      if (!this.commentValue.trim()) return\r\n      \r\n      try {\r\n        const res = await addComment({\r\n          postId: this.id,\r\n          content: this.commentValue,\r\n          parentId: null // È°∂Â±ÇËØÑËÆ∫\r\n        })\r\n        if (res.code === 200) {\r\n          uni.showToast({ title: 'ÂõûÂ§çÊàêÂäü' })\r\n          this.commentValue = ''\r\n          this.loadData() // ÈáçÊñ∞Âä†ËΩΩËØÑËÆ∫ÂàóË°®\r\n        }\r\n      } catch (e) {}\r\n    },\r\n    async onDeletePost() {\r\n      uni.showModal({\r\n        content: 'Á°ÆÂÆöÂà†Èô§ËØ•Âä®ÊÄÅÂêóÔºü',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            const dRes = await deletePost(this.id)\r\n            if (dRes.code === 200) {\r\n              uni.$emit('refreshForum')\r\n              uni.navigateBack()\r\n            }\r\n          }\r\n        }\r\n      })\r\n    },\r\n    async onDeleteComment(cid) {\r\n      const res = await deleteComment(cid)\r\n      if (res.code === 200) this.loadData()\r\n    },\r\n    previewImage(idx) {\r\n      uni.previewImage({\r\n        urls: this.post.images,\r\n        current: idx\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import \"@/uni.scss\";\r\n.detail-container {\r\n  height: 100vh;\r\n  background-color: #f8fcf9;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.status-bar {\r\n  height: var(--status-bar-height);\r\n  background: $forum-primary-gradient;\r\n}\r\n\r\n.nav-bar {\r\n  height: 44px;\r\n  background: $forum-primary-gradient;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 0 30rpx;\r\n  box-shadow: 0 4rpx 20rpx rgba(7, 193, 96, 0.15);\r\n  position: relative;\r\n  z-index: 100;\r\n  \r\n  .nav-back {\r\n    font-size: 52rpx;\r\n    color: #fff;\r\n    width: 60rpx;\r\n    font-weight: 300;\r\n  }\r\n  \r\n  .nav-title {\r\n    font-size: 36rpx;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    letter-spacing: 2rpx;\r\n  }\r\n  \r\n  .nav-right {\r\n    width: 60rpx;\r\n  }\r\n}\r\n\r\n.detail-scroll {\r\n  flex: 1;\r\n  overflow: hidden;\r\n}\r\n\r\n.post-pannel {\r\n  background: #fff;\r\n  padding: 40rpx 30rpx;\r\n  margin-bottom: 24rpx;\r\n  box-shadow: $forum-card-shadow;\r\n  \r\n  .user-row {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-bottom: 30rpx;\r\n    \r\n    .avatar {\r\n      width: 96rpx;\r\n      height: 96rpx;\r\n      border-radius: 50%;\r\n      margin-right: 24rpx;\r\n      background: #f8f8f8;\r\n      border: 4rpx solid #ffffff;\r\n      box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\r\n    }\r\n    \r\n    .info {\r\n      flex: 1;\r\n      \r\n      .name-box {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12rpx;\r\n      }\r\n      \r\n      .nickname {\r\n        font-size: 32rpx;\r\n        font-weight: 600;\r\n        color: $forum-text-main;\r\n      }\r\n      \r\n      .tag {\r\n        font-size: 20rpx;\r\n        color: $forum-primary;\r\n        background: $forum-primary-light;\r\n        padding: 4rpx 16rpx;\r\n        border-radius: 8rpx;\r\n        font-weight: 600;\r\n      }\r\n      \r\n      .time {\r\n        font-size: 24rpx;\r\n        color: $forum-text-light;\r\n        margin-top: 6rpx;\r\n      }\r\n    }\r\n    \r\n    .del-btn {\r\n      font-size: 24rpx;\r\n      color: #ff4d4f;\r\n      background: #fff1f0;\r\n      padding: 0 28rpx;\r\n      height: 56rpx;\r\n      line-height: 56rpx;\r\n      border-radius: 28rpx;\r\n      border: 1rpx solid rgba(255, 77, 79, 0.2);\r\n      font-weight: 500;\r\n      \r\n      &::after { border: none; }\r\n    }\r\n  }\r\n  \r\n  .content {\r\n    .title {\r\n      font-size: 44rpx;\r\n      font-weight: bold;\r\n      color: $forum-text-main;\r\n      margin-bottom: 28rpx;\r\n      display: block;\r\n      line-height: 1.5;\r\n    }\r\n    \r\n    .text {\r\n      font-size: 32rpx;\r\n      color: $forum-text-sub;\r\n      line-height: 1.8;\r\n      margin-bottom: 32rpx;\r\n      display: block;\r\n      white-space: pre-wrap;\r\n    }\r\n    \r\n    .image-grid {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 24rpx;\r\n      \r\n      .detail-img {\r\n        width: 100%;\r\n        border-radius: 24rpx;\r\n        background: #f8f8f8;\r\n        box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.03);\r\n      }\r\n    }\r\n  }\r\n\r\n  .interact-bar {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin-top: 60rpx;\r\n    padding-top: 32rpx;\r\n    border-top: 2rpx solid #fafafa;\r\n    \r\n    .item {\r\n      display: flex;\r\n      align-items: center;\r\n      padding: 16rpx 40rpx;\r\n      background: #f8f9fa;\r\n      border-radius: 40rpx;\r\n      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\r\n      \r\n      .icon {\r\n        font-size: 38rpx;\r\n        margin-right: 12rpx;\r\n      }\r\n      \r\n      .num {\r\n        font-size: 28rpx;\r\n        color: $forum-text-sub;\r\n        font-weight: 600;\r\n      }\r\n      \r\n      &.active {\r\n        background: #fff1f0;\r\n        transform: scale(1.05);\r\n        box-shadow: 0 4rpx 12rpx rgba(255, 77, 79, 0.15);\r\n        .num { color: #ff4d4f; }\r\n      }\r\n      \r\n      &:active { transform: scale(0.95); }\r\n    }\r\n    \r\n    .view-info {\r\n      font-size: 24rpx;\r\n      color: $forum-text-light;\r\n    }\r\n  }\r\n}\r\n\r\n.comment-section {\r\n  padding: 40rpx 30rpx;\r\n  background: #fff;\r\n  min-height: 400rpx;\r\n  padding-bottom: 140rpx;\r\n  box-shadow: $forum-card-shadow;\r\n  \r\n  .section-title {\r\n    font-size: 34rpx;\r\n    font-weight: bold;\r\n    color: $forum-text-main;\r\n    margin-bottom: 40rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    \r\n    &::before {\r\n      content: '';\r\n      width: 10rpx;\r\n      height: 36rpx;\r\n      background: $forum-primary-gradient;\r\n      margin-right: 18rpx;\r\n      border-radius: 6rpx;\r\n    }\r\n  }\r\n}\r\n\r\n.comment-item {\r\n  display: flex;\r\n  margin-bottom: 48rpx;\r\n  \r\n  .c-avatar {\r\n    width: 80rpx;\r\n    height: 80rpx;\r\n    border-radius: 50%;\r\n    margin-right: 24rpx;\r\n    background: #f8f8f8;\r\n    border: 2rpx solid #ffffff;\r\n    box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.03);\r\n  }\r\n  \r\n  .c-body {\r\n    flex: 1;\r\n    \r\n    .c-header {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin-bottom: 10rpx;\r\n      \r\n      .c-nickname {\r\n        font-size: 29rpx;\r\n        font-weight: 600;\r\n        color: $forum-text-main;\r\n      }\r\n      \r\n      .c-time {\r\n        font-size: 22rpx;\r\n        color: $forum-text-light;\r\n      }\r\n    }\r\n    \r\n    .c-text {\r\n      font-size: 29rpx;\r\n      color: $forum-text-sub;\r\n      line-height: 1.6;\r\n      display: block;\r\n    }\r\n    \r\n    .c-delete {\r\n      font-size: 22rpx;\r\n      color: #ff4d4f;\r\n      margin-top: 14rpx;\r\n      display: inline-block;\r\n      opacity: 0.6;\r\n      font-weight: 500;\r\n    }\r\n  }\r\n}\r\n\r\n.no-comment {\r\n  padding: 120rpx 0;\r\n  text-align: center;\r\n  color: #bbb;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.comment-input-bar {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: $forum-glass-bg;\r\n  backdrop-filter: blur(20rpx);\r\n  -webkit-backdrop-filter: blur(20rpx);\r\n  padding: 24rpx 30rpx;\r\n  padding-bottom: calc(24rpx + env(safe-area-inset-bottom));\r\n  display: flex;\r\n  align-items: center;\r\n  box-shadow: 0 -8rpx 32rpx rgba(0,0,0,0.05);\r\n  border-top: 2rpx solid $forum-glass-border;\r\n  z-index: 100;\r\n  \r\n  .c-input {\r\n    flex: 1;\r\n    background: rgba(255, 255, 255, 0.8);\r\n    height: 84rpx;\r\n    border-radius: 42rpx;\r\n    padding: 0 36rpx;\r\n    font-size: 28rpx;\r\n    border: 1rpx solid rgba(0, 0, 0, 0.04);\r\n  }\r\n  \r\n  .send-btn {\r\n    margin-left: 28rpx;\r\n    font-size: 32rpx;\r\n    color: #bbb;\r\n    font-weight: 600;\r\n    transition: all 0.3s;\r\n    \r\n    &.active {\r\n      color: $forum-primary;\r\n      transform: scale(1.05);\r\n    }\r\n    \r\n    &:active { opacity: 0.6; }\r\n  }\r\n}\r\n\r\n.bottom-padding {\r\n  height: 80rpx;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/Delivery Service Platform/uniapp/pages/forum/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getPostDetail","getCommentList","likePost","addComment","deletePost","deleteComment"],"mappings":"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"}