{"version":3,"file":"create.js","sources":["pages/forum/create.vue","D:/Users/windows/Downloads/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZm9ydW0vY3JlYXRlLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"create-container\">\r\n    <view class=\"status-bar\"></view>\r\n    <view class=\"nav-bar\">\r\n      <view class=\"nav-back\" @tap=\"goBack\">\r\n        <text class=\"iconfont\">✕</text>\r\n      </view>\r\n      <view class=\"nav-title\">发布动态</view>\r\n      <view class=\"nav-right\">\r\n        <button class=\"submit-btn\" :disabled=\"!canSubmit || submitting\" @tap=\"submit\">发布</button>\r\n      </view>\r\n    </view>\r\n\r\n    <scroll-view class=\"form-content\" scroll-y>\r\n      <!-- 标题内容 -->\r\n      <view class=\"input-section border-bottom\">\r\n        <input\r\n          class=\"title-input\"\r\n          v-model=\"title\"\r\n          placeholder=\"起个吸睛的标题吧...\"\r\n          maxlength=\"100\"\r\n        />\r\n      </view>\r\n\r\n      <!-- 文字内容 -->\r\n      <view class=\"input-section\">\r\n        <textarea\r\n          class=\"content-textarea\"\r\n          v-model=\"content\"\r\n          placeholder=\"分享这一刻的想法...\"\r\n          maxlength=\"5000\"\r\n          auto-height\r\n        ></textarea>\r\n        <view class=\"char-count\">{{ content.length }}/5000</view>\r\n      </view>\r\n\r\n      <!-- 标签选择 -->\r\n      <view class=\"tag-section\">\r\n        <text class=\"tag-label\">选择分类：</text>\r\n        <view class=\"tag-list\">\r\n          <view \r\n            v-for=\"t in tagOptions\" \r\n            :key=\"t\" \r\n            class=\"tag-item\" \r\n            :class=\"{active: tag === t}\"\r\n            @tap=\"tag = t\"\r\n          >{{ t }}</view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 图片上传 -->\r\n      <view class=\"image-section\">\r\n        <view class=\"image-list\">\r\n          <view class=\"image-item\" v-for=\"(img, index) in images\" :key=\"index\">\r\n            <image :src=\"img\" mode=\"aspectFill\" @tap=\"previewImage(index)\"></image>\r\n            <view class=\"delete-icon\" @tap.stop=\"removeImage(index)\">×</view>\r\n          </view>\r\n          <view v-if=\"images.length < 9\" class=\"upload-box\" @tap=\"chooseImage\">\r\n            <text class=\"plus\">+</text>\r\n            <text class=\"upload-text\">上传图片</text>\r\n          </view>\r\n        </view>\r\n        <view class=\"image-tip\">最多可上传9张图片</view>\r\n      </view>\r\n    </scroll-view>\r\n\r\n    <!-- 加载中遮罩 -->\r\n    <view v-if=\"submitting\" class=\"submitting-overlay\">\r\n      <view class=\"loading-box\">\r\n        <view class=\"loading-icon\"></view>\r\n        <text>正在发布...</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { createPost } from '@/api/forum.js'\r\nimport { BASE_URL } from '@/utils/config.js'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      title: '',\r\n      content: '',\r\n      tag: '吐槽',\r\n      tagOptions: ['失物', '吐槽', '闲置', '求助', '表白'],\r\n      images: [],\r\n      submitting: false\r\n    }\r\n  },\r\n  computed: {\r\n    canSubmit() {\r\n      return this.title.trim().length > 0 && this.content.trim().length > 0\r\n    }\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      if (this.title || this.content || this.images.length > 0) {\r\n        uni.showModal({\r\n          title: '提示',\r\n          content: '退出将丢失已编辑的内容，确定吗？',\r\n          success: (res) => {\r\n            if (res.confirm) uni.navigateBack()\r\n          }\r\n        })\r\n      } else {\r\n        uni.navigateBack()\r\n      }\r\n    },\r\n    async chooseImage() {\r\n      const count = 9 - this.images.length\r\n      uni.chooseImage({\r\n        count: count,\r\n        sizeType: ['compressed'],\r\n        sourceType: ['album', 'camera'],\r\n        success: (res) => {\r\n          // 在实际项目中，这里应该先上传到服务器/OSS\r\n          // 这里暂时直接存入本地路径预览，模拟上传过程\r\n          this.uploadImages(res.tempFilePaths)\r\n        }\r\n      })\r\n    },\r\n    async uploadImages(paths) {\r\n      uni.showLoading({ title: '正在上传...' })\r\n      \r\n      // 模拟多图上传逻辑\r\n      for (const path of paths) {\r\n        try {\r\n          // 这里应该是真实的 uni.uploadFile\r\n          // const res = await uni.uploadFile({ ... })\r\n          // const data = JSON.parse(res.data)\r\n          // if (data.code === 200) this.images.push(data.data.url)\r\n          \r\n          // 暂时模拟直接成功\r\n          this.images.push(path) \r\n        } catch (e) {\r\n          uni.showToast({ title: '部分图片上传失败', icon: 'none' })\r\n        }\r\n      }\r\n      uni.hideLoading()\r\n    },\r\n    removeImage(index) {\r\n      this.images.splice(index, 1)\r\n    },\r\n    previewImage(index) {\r\n      uni.previewImage({\r\n        urls: this.images,\r\n        current: index\r\n      })\r\n    },\r\n    async submit() {\r\n      if (this.submitting) return\r\n      this.submitting = true\r\n      \r\n      try {\r\n        const res = await createPost({\r\n          title: this.title,\r\n          content: this.content,\r\n          tag: this.tag,\r\n          images: this.images\r\n        })\r\n        \r\n        if (res.code === 200) {\r\n          uni.showToast({ title: '发布成功', icon: 'success' })\r\n          // 发送全局事件通知列表刷新\r\n          uni.$emit('refreshForum')\r\n          setTimeout(() => {\r\n            uni.navigateBack()\r\n          }, 1500)\r\n        } else {\r\n          uni.showToast({ title: res.message || '发布失败', icon: 'none' })\r\n          this.submitting = false\r\n        }\r\n      } catch (error) {\r\n        uni.showToast({ title: '网络错误', icon: 'none' })\r\n        this.submitting = false\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import \"@/uni.scss\";\r\n.create-container {\r\n  height: 100vh;\r\n  background-color: #fff;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.status-bar {\r\n  height: var(--status-bar-height);\r\n  background: $forum-primary-gradient;\r\n}\r\n\r\n.nav-bar {\r\n  height: 44px;\r\n  background: $forum-primary-gradient;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 0 30rpx;\r\n  box-shadow: 0 4rpx 20rpx rgba(7, 193, 96, 0.15);\r\n  position: relative;\r\n  z-index: 100;\r\n  \r\n  .nav-back {\r\n    font-size: 44rpx;\r\n    color: #fff;\r\n    width: 80rpx;\r\n    font-weight: 300;\r\n  }\r\n  \r\n  .nav-title {\r\n    font-size: 36rpx;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    letter-spacing: 2rpx;\r\n  }\r\n  \r\n  .nav-right {\r\n    width: 140rpx;\r\n    display: flex;\r\n    justify-content: flex-end;\r\n  }\r\n  \r\n  .submit-btn {\r\n    margin: 0;\r\n    padding: 0 32rpx;\r\n    height: 60rpx;\r\n    line-height: 60rpx;\r\n    background: #fff;\r\n    color: $forum-primary;\r\n    font-size: 28rpx;\r\n    border-radius: 30rpx;\r\n    font-weight: 600;\r\n    border: none;\r\n    box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\r\n    \r\n    &[disabled] {\r\n      background: rgba(255, 255, 255, 0.6);\r\n      color: rgba(7, 193, 96, 0.5);\r\n      box-shadow: none;\r\n    }\r\n    \r\n    &:active:not([disabled]) {\r\n      transform: scale(0.95);\r\n      background: #f0f0f0;\r\n    }\r\n  }\r\n}\r\n\r\n.form-content {\r\n  flex: 1;\r\n  padding: 40rpx 30rpx;\r\n}\r\n\r\n.input-section {\r\n  position: relative;\r\n  margin-bottom: 40rpx;\r\n  \r\n  .content-textarea {\r\n    width: 100%;\r\n    min-height: 360rpx;\r\n    font-size: 32rpx;\r\n    line-height: 1.6;\r\n    color: $forum-text-main;\r\n  }\r\n  \r\n  .char-count {\r\n    text-align: right;\r\n    font-size: 24rpx;\r\n    color: $forum-text-light;\r\n    margin-top: 16rpx;\r\n  }\r\n}\r\n\r\n.border-bottom {\r\n  border-bottom: 2rpx solid #f8f8f8;\r\n  padding-bottom: 24rpx;\r\n}\r\n\r\n.title-input {\r\n  width: 100%;\r\n  height: 80rpx;\r\n  font-size: 38rpx;\r\n  font-weight: bold;\r\n  color: $forum-text-main;\r\n}\r\n\r\n.tag-section {\r\n  margin-bottom: 48rpx;\r\n  \r\n  .tag-label {\r\n    font-size: 28rpx;\r\n    font-weight: 600;\r\n    color: $forum-text-main;\r\n    margin-bottom: 24rpx;\r\n    display: block;\r\n  }\r\n  \r\n  .tag-list {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    gap: 20rpx;\r\n  }\r\n  \r\n  .tag-item {\r\n    padding: 12rpx 36rpx;\r\n    background: #f5f5f5;\r\n    border-radius: 40rpx;\r\n    font-size: 26rpx;\r\n    color: $forum-text-sub;\r\n    transition: all 0.3s;\r\n    border: 1rpx solid transparent;\r\n    \r\n    &.active {\r\n      background: $forum-primary-light;\r\n      color: $forum-primary;\r\n      border-color: rgba(7, 193, 96, 0.2);\r\n      font-weight: 600;\r\n      box-shadow: 0 4rpx 12rpx rgba(7, 193, 96, 0.1);\r\n    }\r\n  }\r\n}\r\n\r\n.image-section {\r\n  .image-list {\r\n    display: grid;\r\n    grid-template-columns: repeat(3, 1fr);\r\n    gap: 24rpx;\r\n  }\r\n  \r\n  .image-item {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 220rpx;\r\n    \r\n    image {\r\n      width: 100%;\r\n      height: 100%;\r\n      border-radius: 20rpx;\r\n      box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\r\n    }\r\n    \r\n    .delete-icon {\r\n      position: absolute;\r\n      top: -12rpx;\r\n      right: -12rpx;\r\n      width: 44rpx;\r\n      height: 44rpx;\r\n      background: rgba(255, 77, 79, 0.9);\r\n      color: #fff;\r\n      border-radius: 50%;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      font-size: 32rpx;\r\n      border: 4rpx solid #fff;\r\n      box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);\r\n    }\r\n  }\r\n  \r\n  .upload-box {\r\n    width: 100%;\r\n    height: 220rpx;\r\n    background: #fbfbfb;\r\n    border-radius: 20rpx;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    border: 2rpx dashed #e0e0e0;\r\n    transition: all 0.2s;\r\n    \r\n    .plus {\r\n      font-size: 64rpx;\r\n      color: #ccc;\r\n      margin-bottom: 4rpx;\r\n    }\r\n    \r\n    .upload-text {\r\n      font-size: 24rpx;\r\n      color: #bbb;\r\n    }\r\n    \r\n    &:active {\r\n      background: #f5f5f5;\r\n      border-color: $forum-primary;\r\n    }\r\n  }\r\n  \r\n  .image-tip {\r\n    margin-top: 24rpx;\r\n    font-size: 24rpx;\r\n    color: $forum-text-light;\r\n  }\r\n}\r\n\r\n.submitting-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: $forum-glass-bg;\r\n  backdrop-filter: blur(10rpx);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 999;\r\n  \r\n  .loading-box {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    background: #fff;\r\n    padding: 40rpx 60rpx;\r\n    border-radius: 32rpx;\r\n    box-shadow: $forum-glass-shadow;\r\n    \r\n    .loading-icon {\r\n      width: 64rpx;\r\n      height: 64rpx;\r\n      border: 6rpx solid #f3f3f3;\r\n      border-top: 6rpx solid $forum-primary;\r\n      border-radius: 50%;\r\n      animation: spin 1s linear infinite;\r\n      margin-bottom: 24rpx;\r\n    }\r\n    \r\n    text {\r\n      font-size: 28rpx;\r\n      color: $forum-text-main;\r\n      font-weight: 500;\r\n    }\r\n  }\r\n}\r\n\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/Delivery Service Platform/uniapp/pages/forum/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","createPost"],"mappings":";;;AAgFA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,OAAO;AAAA,MACP,SAAS;AAAA,MACT,KAAK;AAAA,MACL,YAAY,CAAC,MAAM,MAAM,MAAM,MAAM,IAAI;AAAA,MACzC,QAAQ,CAAE;AAAA,MACV,YAAY;AAAA,IACd;AAAA,EACD;AAAA,EACD,UAAU;AAAA,IACR,YAAY;AACV,aAAO,KAAK,MAAM,KAAI,EAAG,SAAS,KAAK,KAAK,QAAQ,KAAM,EAAC,SAAS;AAAA,IACtE;AAAA,EACD;AAAA,EACD,SAAS;AAAA,IACP,SAAS;AACP,UAAI,KAAK,SAAS,KAAK,WAAW,KAAK,OAAO,SAAS,GAAG;AACxDA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,SAAS;AAAA,UACT,SAAS,CAAC,QAAQ;AAChB,gBAAI,IAAI;AAASA,4BAAG,MAAC,aAAa;AAAA,UACpC;AAAA,SACD;AAAA,aACI;AACLA,sBAAAA,MAAI,aAAa;AAAA,MACnB;AAAA,IACD;AAAA,IACD,MAAM,cAAc;AAClB,YAAM,QAAQ,IAAI,KAAK,OAAO;AAC9BA,oBAAAA,MAAI,YAAY;AAAA,QACd;AAAA,QACA,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,CAAC,QAAQ;AAGhB,eAAK,aAAa,IAAI,aAAa;AAAA,QACrC;AAAA,OACD;AAAA,IACF;AAAA,IACD,MAAM,aAAa,OAAO;AACxBA,oBAAAA,MAAI,YAAY,EAAE,OAAO,WAAW;AAGpC,iBAAW,QAAQ,OAAO;AACxB,YAAI;AAOF,eAAK,OAAO,KAAK,IAAI;AAAA,QACvB,SAAS,GAAG;AACVA,wBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AAAA,QACnD;AAAA,MACF;AACAA,oBAAAA,MAAI,YAAY;AAAA,IACjB;AAAA,IACD,YAAY,OAAO;AACjB,WAAK,OAAO,OAAO,OAAO,CAAC;AAAA,IAC5B;AAAA,IACD,aAAa,OAAO;AAClBA,oBAAAA,MAAI,aAAa;AAAA,QACf,MAAM,KAAK;AAAA,QACX,SAAS;AAAA,OACV;AAAA,IACF;AAAA,IACD,MAAM,SAAS;AACb,UAAI,KAAK;AAAY;AACrB,WAAK,aAAa;AAElB,UAAI;AACF,cAAM,MAAM,MAAMC,qBAAW;AAAA,UAC3B,OAAO,KAAK;AAAA,UACZ,SAAS,KAAK;AAAA,UACd,KAAK,KAAK;AAAA,UACV,QAAQ,KAAK;AAAA,SACd;AAED,YAAI,IAAI,SAAS,KAAK;AACpBD,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAEhDA,wBAAG,MAAC,MAAM,cAAc;AACxB,qBAAW,MAAM;AACfA,0BAAAA,MAAI,aAAa;AAAA,UAClB,GAAE,IAAI;AAAA,eACF;AACLA,8BAAI,UAAU,EAAE,OAAO,IAAI,WAAW,QAAQ,MAAM,QAAQ;AAC5D,eAAK,aAAa;AAAA,QACpB;AAAA,MACA,SAAO,OAAO;AACdA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAC7C,aAAK,aAAa;AAAA,MACpB;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnLA,GAAG,WAAW,eAAe;"}