{"version":3,"file":"my-posts.js","sources":["pages/forum/my-posts.vue","D:/Users/windows/Downloads/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZm9ydW0vbXktcG9zdHMudnVl"],"sourcesContent":["<template>\r\n  <view class=\"my-posts-container\">\r\n    <view class=\"status-bar\"></view>\r\n    <!-- 自定义导航栏 -->\r\n    <view class=\"nav-bar\">\r\n      <view class=\"nav-back\" @tap=\"goBack\">\r\n        <text class=\"iconfont\">‹</text>\r\n      </view>\r\n      <view class=\"nav-title\">我的帖子</view>\r\n      <view class=\"nav-right\"></view>\r\n    </view>\r\n\r\n    <!-- 帖子列表 -->\r\n    <scroll-view \r\n      class=\"post-list-scroll\" \r\n      scroll-y \r\n      @scrolltolower=\"loadMore\"\r\n      refresher-enabled\r\n      :refresher-triggered=\"refreshing\"\r\n      @refresherrefresh=\"onRefresh\"\r\n    >\r\n      <view class=\"post-list\">\r\n        <post-card \r\n          v-for=\"post in posts\" \r\n          :key=\"post.id\"\r\n          :post=\"post\"\r\n          :is-my-post=\"true\"\r\n          @click=\"goToDetail\"\r\n          @delete=\"handleDelete\"\r\n          @like=\"onLike\"\r\n        />\r\n        \r\n        <!-- 加载状态 -->\r\n        <view class=\"loading-status\">\r\n          <view v-if=\"loading\" class=\"loading-spinner\"></view>\r\n          <text v-if=\"loading\">正在加载...</text>\r\n          <block v-else>\r\n            <text v-if=\"posts.length === 0\">还没有发布过帖子哦</text>\r\n            <text v-else-if=\"noMore\">没有更多了</text>\r\n          </block>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport PostCard from '../../components/post-card/post-card.vue'\r\nimport { getMyPosts, deletePost, likePost } from '../../api/forum.js'\r\n\r\nexport default {\r\n  components: {\r\n    'post-card': PostCard\r\n  },\r\n  data() {\r\n    return {\r\n      posts: [],\r\n      pageNum: 1,\r\n      pageSize: 10,\r\n      loading: false,\r\n      noMore: false,\r\n      refreshing: false\r\n    }\r\n  },\r\n  onLoad() {\r\n    this.loadPosts()\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      uni.navigateBack()\r\n    },\r\n    async loadPosts(isRefresh = false) {\r\n      if (this.loading) return\r\n      this.loading = true\r\n      \r\n      try {\r\n        const params = {\r\n          page: isRefresh ? 1 : this.pageNum,\r\n          size: this.pageSize\r\n        }\r\n        \r\n        const res = await getMyPosts(params)\r\n        \r\n        if (res.code === 200) {\r\n          let list = []\r\n          let total = 0\r\n          \r\n          if (res.data) {\r\n             if (Array.isArray(res.data)) {\r\n                 list = res.data\r\n                 total = list.length\r\n             } else if (res.data.records && Array.isArray(res.data.records)) {\r\n                 list = res.data.records\r\n                 total = res.data.total || 0\r\n             }\r\n          }\r\n          \r\n          if (isRefresh) {\r\n            this.posts = list\r\n            this.pageNum = 2\r\n            this.noMore = list.length < this.pageSize\r\n          } else {\r\n            this.posts = [...this.posts, ...list]\r\n            this.pageNum++\r\n            this.noMore = (list.length < this.pageSize) || (total > 0 && this.posts.length >= total)\r\n          }\r\n        } else {\r\n          if (isRefresh) this.posts = []\r\n          this.noMore = true\r\n        }\r\n      } catch (error) {\r\n        console.error('❌ 加载我的帖子失败:', error)\r\n        uni.showToast({ title: '加载失败', icon: 'none' })\r\n      } finally {\r\n        this.loading = false\r\n        this.refreshing = false\r\n      }\r\n    },\r\n    onRefresh() {\r\n      this.refreshing = true\r\n      this.loadPosts(true)\r\n    },\r\n    loadMore() {\r\n      if (!this.noMore) {\r\n        this.loadPosts()\r\n      }\r\n    },\r\n    goToDetail(postId) {\r\n      uni.navigateTo({\r\n        url: `/pages/forum/detail?id=${postId}`\r\n      })\r\n    },\r\n    handleDelete(postId) {\r\n      uni.showModal({\r\n        title: '提示',\r\n        content: '确定要删除这条帖子吗？',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              const delRes = await deletePost(postId)\r\n              if (delRes.code === 200) {\r\n                uni.showToast({ title: '已删除' })\r\n                // 从列表中移除\r\n                this.posts = this.posts.filter(p => p.id !== postId)\r\n                // 通知广场刷新\r\n                uni.$emit('refreshForum')\r\n              }\r\n            } catch (error) {\r\n              uni.showToast({ title: '删除失败', icon: 'none' })\r\n            }\r\n          }\r\n        }\r\n      })\r\n    },\r\n    async onLike(postId) {\r\n      try {\r\n        const res = await likePost(postId)\r\n        if (res.code === 200) {\r\n          const index = this.posts.findIndex(p => p.id === postId)\r\n          if (index !== -1) {\r\n            const post = this.posts[index]\r\n            post.liked = res.data.liked\r\n            post.likeCount = res.data.likeCount\r\n            this.posts[index] = post\r\n          }\r\n        }\r\n      } catch (error) {\r\n        uni.showToast({ title: '操作失败', icon: 'none' })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import \"@/uni.scss\";\r\n.my-posts-container {\r\n  height: 100vh;\r\n  background-color: #f8fcf9;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.status-bar {\r\n  height: var(--status-bar-height);\r\n  background: $forum-primary-gradient;\r\n}\r\n\r\n.nav-bar {\r\n  height: 44px;\r\n  background: $forum-primary-gradient;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 0 30rpx;\r\n  box-shadow: 0 4rpx 20rpx rgba(7, 193, 96, 0.15);\r\n  position: relative;\r\n  z-index: 100;\r\n  \r\n  .nav-back {\r\n    width: 60rpx;\r\n    font-size: 52rpx;\r\n    color: #fff;\r\n    font-weight: 300;\r\n  }\r\n  \r\n  .nav-title {\r\n    font-size: 36rpx;\r\n    font-weight: 600;\r\n    color: #fff;\r\n    letter-spacing: 2rpx;\r\n  }\r\n  \r\n  .nav-right {\r\n    width: 60rpx;\r\n  }\r\n}\r\n\r\n.post-list-scroll {\r\n  flex: 1;\r\n  height: 0;\r\n}\r\n\r\n.post-list {\r\n  padding: 24rpx;\r\n  \r\n  .loading-status {\r\n    padding: 60rpx 0;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    color: #bbb;\r\n    font-size: 26rpx;\r\n    \r\n    .loading-spinner {\r\n      width: 44rpx;\r\n      height: 44rpx;\r\n      border: 4rpx solid #f3f3f3;\r\n      border-top: 4rpx solid $forum-primary;\r\n      border-radius: 50%;\r\n      animation: spin 1s linear infinite;\r\n      margin-bottom: 20rpx;\r\n    }\r\n  }\r\n}\r\n\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/Delivery Service Platform/uniapp/pages/forum/my-posts.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getMyPosts","deletePost","likePost"],"mappings":"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"}