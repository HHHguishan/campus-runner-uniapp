{"version":3,"file":"index.js","sources":["pages/chat/index.vue","D:/Users/windows/Downloads/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2hhdC9pbmRleC52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"chat-container\">\r\n\t\t<!-- 顶部导航栏 -->\r\n\t\t<view class=\"nav-bar\" :style=\"{ paddingTop: statusBarHeight + 'px' }\">\r\n\t\t\t<view class=\"nav-content\">\r\n\t\t\t\t<view class=\"back-btn\" @tap=\"goBack\">\r\n\t\t\t\t\t<text class=\"iconfont icon-back\">←</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"title-group\">\r\n\t\t\t\t\t<view class=\"title\">{{ roleName }}</view>\r\n\t\t\t\t\t<view class=\"status\" :class=\"socketOpen ? 'status-online' : 'status-offline'\">\r\n\t\t\t\t\t\t{{ socketOpen ? '串联在线' : '等待重连...' }}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"placeholder\"></view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 聊天内容区域 -->\r\n\t\t<scroll-view \r\n\t\t\tclass=\"message-list\" \r\n\t\t\tscroll-y \r\n\t\t\t:scroll-into-view=\"lastMsgId\" \r\n\t\t\t@scrolltoupper=\"loadHistory\"\r\n\t\t>\r\n\t\t\t<view class=\"msg-padding\" :style=\"{ height: statusBarHeight + 50 + 'px' }\"></view>\r\n\t\t\t\r\n\t\t\t<view v-for=\"(msg, index) in messages\" :key=\"msg.id || index\" :id=\"'chat-item-' + (msg.id || index)\" class=\"msg-item\" :class=\"{ 'msg-mine': msg.senderId == mineId }\">\r\n\t\t\t\t<view class=\"msg-time\" v-if=\"showTime(index)\">{{ formatTime(msg.createTime) }}</view>\r\n\t\t\t\t<view class=\"msg-content-wrapper\">\r\n\t\t\t\t\t<image class=\"avatar\" :src=\"msg.senderId == mineId ? myAvatar : otherAvatar\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t<view class=\"msg-body\">\r\n\t\t\t\t\t\t<text class=\"msg-nickname\" v-if=\"msg.senderId != mineId\">{{ roleName }}</text>\r\n\t\t\t\t\t\t<view class=\"msg-bubble\">\r\n\t\t\t\t\t\t\t<text class=\"text\">{{ msg.content }}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<view class=\"msg-footer\" style=\"height: 120rpx;\"></view>\r\n\t\t</scroll-view>\r\n\r\n\t\t<!-- 底部输入栏 -->\r\n\t\t<view class=\"input-bar\" :style=\"{ paddingBottom: safeAreaInsets.bottom + 'px' }\">\r\n\t\t\t<input \r\n\t\t\t\tclass=\"input\" \r\n\t\t\t\tv-model=\"inputMsg\" \r\n\t\t\t\tplaceholder=\"请输入消息...\" \r\n\t\t\t\tconfirm-type=\"send\" \r\n\t\t\t\t@confirm=\"sendMsg\" \r\n\t\t\t/>\r\n\t\t\t<button class=\"send-btn\" @tap=\"sendMsg\" :disabled=\"!inputMsg.trim() || !socketOpen\">发送</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport { BASE_URL, API_BASE_URL } from '@/utils/config.js';\r\n\timport { getToken, getUserInfo } from '@/utils/token.js';\r\n\timport { get } from '@/utils/request.js';\r\n\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tstatusBarHeight: 0,\r\n\t\t\t\tsafeAreaInsets: { bottom: 0 },\r\n\t\t\t\torderId: null,\r\n\t\t\t\treceiverId: null,\r\n\t\t\t\troleName: '对方',\r\n\t\t\t\tmineId: null,\r\n\t\t\t\tnickname: '',\r\n\t\t\t\tmyAvatar: '',\r\n\t\t\t\totherAvatar: '',\r\n\t\t\t\tinputMsg: '',\r\n\t\t\t\tmessages: [],\r\n\t\t\t\tlastMsgId: '',\r\n\t\t\t\tsocketOpen: false,\r\n\t\t\t\tsocketTask: null,\r\n\t\t\t\treconnectTimer: null\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\tconst systemInfo = uni.getSystemInfoSync();\r\n\t\t\tthis.statusBarHeight = systemInfo.statusBarHeight;\r\n\t\t\tthis.safeAreaInsets = systemInfo.safeAreaInsets || { bottom: 0 };\r\n\t\t\t\r\n\t\t\tthis.orderId = options.orderId;\r\n\t\t\tthis.receiverId = options.receiverId;\r\n\t\t\tthis.nickname = decodeURIComponent(options.nickname || '') || (options.role == 'rider' ? '骑手' : '用户');\r\n\t\t\tthis.roleName = this.nickname;\r\n\t\t\t\r\n\t\t\tconst userInfo = getUserInfo() || {};\r\n\t\t\tthis.mineId = userInfo.id;\r\n\t\t\tthis.myAvatar = userInfo.avatar || '/static/default-avatar.png';\r\n\t\t\tthis.otherAvatar = decodeURIComponent(options.avatar || '') || '/static/default-avatar.png';\r\n\r\n\t\t\tconsole.log('Chat Init:', {\r\n\t\t\t\torderId: this.orderId,\r\n\t\t\t\treceiverId: this.receiverId,\r\n\t\t\t\tmineId: this.mineId,\r\n\t\t\t\trole: options.role\r\n\t\t\t});\r\n\r\n\t\t\tif (!this.receiverId) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '未获取到聊天对象ID，无法发送消息',\r\n\t\t\t\t\tshowCancel: false\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis.loadHistory();\r\n\t\t\tthis.connectSocket();\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tthis.closeSocket();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tgoBack() {\r\n\t\t\t\tuni.navigateBack();\r\n\t\t\t},\r\n\t\t\tformatTime(time) {\r\n\t\t\t\tif (!time) return '';\r\n\t\t\t\tconst date = new Date(time);\r\n\t\t\t\treturn `${date.getHours()}:${date.getMinutes().toString().padStart(2, '0')}`;\r\n\t\t\t},\r\n\t\t\tshowTime(index) {\r\n\t\t\t\tif (index === 0) return true;\r\n\t\t\t\tconst curr = new Date(this.messages[index].createTime).getTime();\r\n\t\t\t\tconst prev = new Date(this.messages[index - 1].createTime).getTime();\r\n\t\t\t\treturn curr - prev > 5 * 60 * 1000; // 5分钟显示一次时间\r\n\t\t\t},\r\n\t\t\tasync loadHistory() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst res = await get(`/chat/history/${this.orderId}`);\r\n\t\t\t\t\tif (res.code === 200) {\r\n\t\t\t\t\t\tthis.messages = res.data;\r\n\t\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.error('加载历史失败', err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tconnectSocket() {\r\n\t\t\t\tlet token = getToken();\r\n\t\t\t\tif (token && token.startsWith('Bearer ')) {\r\n\t\t\t\t\ttoken = token.substring(7);\r\n\t\t\t\t}\r\n\t\t\t\t// 再次清理可能存在的 Bearer (以防 getToken 返回的是完整 Header)\r\n\t\t\t\ttoken = token.trim();\r\n\t\t\t\t\r\n\t\t\t\t// 注意：小程序正式环境需要 wss\r\n\t\t\t\tconst baseWsUrl = API_BASE_URL.startsWith('https') ? API_BASE_URL.replace('https', 'wss') : API_BASE_URL.replace('http', 'ws');\r\n\t\t\t\tconst wsUrl = `${baseWsUrl}/ws/chat/${encodeURIComponent(token)}/${this.orderId}`;\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('Target WS URL:', wsUrl);\r\n\t\t\t\t\r\n\t\t\t\tthis.socketTask = uni.connectSocket({\r\n\t\t\t\t\turl: wsUrl,\r\n\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\tconsole.log('WebSocket 握手开始...');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tconsole.error('uni.connectSocket 调用失败', err);\r\n\t\t\t\t\t\tthis.reconnect();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.socketTask.onOpen(() => {\r\n\t\t\t\t\tthis.socketOpen = true;\r\n\t\t\t\t\tconsole.log('WebSocket 已连接');\r\n\t\t\t\t\tuni.showToast({ title: '已连接', icon: 'none', duration: 1000 });\r\n\t\t\t\t\tif (this.reconnectTimer) {\r\n\t\t\t\t\t\tclearInterval(this.reconnectTimer);\r\n\t\t\t\t\t\tthis.reconnectTimer = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.socketTask.onMessage((res) => {\r\n\t\t\t\t\tconsole.log('收到 WebSocket 原始消息:', res);\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// 兼容性处理：有些环境 res.data 已经是对象\r\n\t\t\t\t\t\tconst msg = typeof res.data === 'string' ? JSON.parse(res.data) : res.data;\r\n\t\t\t\t\t\tconsole.log('解析后的消息对象:', msg);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 过滤非本订单消息\r\n\t\t\t\t\t\tif (msg.orderId == this.orderId) {\r\n\t\t\t\t\t\t\t// 查重：避免由于回显逻辑导致重复\r\n\t\t\t\t\t\t\tif (msg.id) {\r\n\t\t\t\t\t\t\t\tconst exists = this.messages.some(m => m.id === msg.id);\r\n\t\t\t\t\t\t\t\tif (exists) return;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis.messages.push(msg);\r\n\t\t\t\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 震动提示（可选）\r\n\t\t\t\t\t\t\tuni.vibrateShort();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log('收到其他订单消息，已忽略:', msg.orderId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.error('解析消息失败', e);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.socketTask.onClose(() => {\r\n\t\t\t\t\tthis.socketOpen = false;\r\n\t\t\t\t\tconsole.log('WebSocket 已关闭');\r\n\t\t\t\t\tthis.reconnect();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.socketTask.onError((err) => {\r\n\t\t\t\t\tthis.socketOpen = false;\r\n\t\t\t\t\tconsole.error('WebSocket 错误', err);\r\n\t\t\t\t\tuni.showToast({ title: '连接错误: ' + (err.errMsg || '未知'), icon: 'none' });\r\n\t\t\t\t\tthis.reconnect();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\treconnect() {\r\n\t\t\t\tif (this.reconnectTimer) return;\r\n\t\t\t\tthis.reconnectTimer = setInterval(() => {\r\n\t\t\t\t\tconsole.log('正在尝试重连...');\r\n\t\t\t\t\tthis.connectSocket();\r\n\t\t\t\t}, 10000);\r\n\t\t\t},\r\n\t\t\tcloseSocket() {\r\n\t\t\t\tif (this.socketTask) {\r\n\t\t\t\t\tthis.socketTask.close();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.reconnectTimer) {\r\n\t\t\t\t\tclearInterval(this.reconnectTimer);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsendMsg() {\r\n\t\t\t\tif (!this.inputMsg.trim() || !this.socketOpen) {\r\n\t\t\t\t\tif (!this.socketOpen) {\r\n\t\t\t\t\t\tuni.showToast({ title: '连接未就绪', icon: 'none' });\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (!this.receiverId) {\r\n\t\t\t\t\tuni.showToast({ title: '缺少接收者', icon: 'none' });\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst msgData = {\r\n\t\t\t\t\torderId: this.orderId,\r\n\t\t\t\t\treceiverId: this.receiverId,\r\n\t\t\t\t\tcontent: this.inputMsg,\r\n\t\t\t\t\tmsgType: 1\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('Sending Msg:', msgData);\r\n\t\t\t\t\r\n\t\t\t\tthis.socketTask.send({\r\n\t\t\t\t\tdata: JSON.stringify(msgData),\r\n\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\tthis.inputMsg = '';\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tuni.showToast({ title: '发送失败', icon: 'none' });\r\n\t\t\t\t\t\tconsole.error('发送错误', err);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tscrollToBottom() {\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tif (this.messages.length > 0) {\r\n\t\t\t\t\t\t\tconst lastIndex = this.messages.length - 1;\r\n\t\t\t\t\t\t\tconst lastMsg = this.messages[lastIndex];\r\n\t\t\t\t\t\t\tthis.lastMsgId = 'chat-item-' + (lastMsg.id || lastIndex);\r\n\t\t\t\t\t\t\tconsole.log('Scrolling to bottom, anchor:', this.lastMsgId);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 200); // 增加延迟确保图片和DOM渲染完成\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.chat-container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\theight: 100vh;\r\n\t\tbackground-color: #f5f5f5;\r\n\t}\r\n\r\n\t.nav-bar {\r\n\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n\t\tcolor: #fff;\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tz-index: 100;\r\n\t\t\r\n\t\t.nav-content {\r\n\t\t\theight: 44px;\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tjustify-content: space-between;\r\n\t\t\tpadding: 0 30rpx;\r\n\t\t\t\r\n\t\t\t.title-group {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\t\r\n\t\t\t\t.title {\r\n\t\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tline-height: 1.2;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.status {\r\n\t\t\t\t\tfont-size: 20rpx;\r\n\t\t\t\t\tmargin-top: 4rpx;\r\n\t\t\t\t\t\r\n\t\t\t\t\t&.status-online {\r\n\t\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\t\topacity: 0.9;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t&.status-offline {\r\n\t\t\t\t\t\tcolor: #ffdada;\r\n\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.back-btn, .placeholder {\r\n\t\t\t\twidth: 60rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.message-list {\r\n\t\tflex: 1;\r\n\t\t\r\n\t\t.msg-item {\r\n\t\t\tpadding: 20rpx 30rpx;\r\n\t\t\t\r\n\t\t\t.msg-time {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tfont-size: 22rpx;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t.msg-content-wrapper {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: row;\r\n\t\t\t\t\r\n\t\t\t\t.avatar {\r\n\t\t\t\t\twidth: 80rpx;\r\n\t\t\t\t\theight: 80rpx;\r\n\t\t\t\t\tborder-radius: 10rpx;\r\n\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t\tbackground-color: #eee;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t.msg-body {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: column;\r\n\t\t\t\t\tmax-width: 70%;\r\n\t\t\t\t\t\r\n\t\t\t\t\t.msg-nickname {\r\n\t\t\t\t\t\tfont-size: 22rpx;\r\n\t\t\t\t\t\tcolor: #999;\r\n\t\t\t\t\t\tmargin-bottom: 6rpx;\r\n\t\t\t\t\t\tmargin-left: 10rpx;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.msg-bubble {\r\n\t\t\t\t\t\tbackground-color: #fff;\r\n\t\t\t\t\t\tpadding: 20rpx;\r\n\t\t\t\t\t\tborder-radius: 10rpx;\r\n\t\t\t\t\t\tposition: relative;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t&::before {\r\n\t\t\t\t\t\t\tcontent: '';\r\n\t\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\t\tleft: -10rpx;\r\n\t\t\t\t\t\t\ttop: 30rpx;\r\n\t\t\t\t\t\t\tborder-top: 10rpx solid transparent;\r\n\t\t\t\t\t\t\tborder-bottom: 10rpx solid transparent;\r\n\t\t\t\t\t\t\tborder-right: 10rpx solid #fff;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t.text {\r\n\t\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\t\tword-break: break-all;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t&.msg-mine {\r\n\t\t\t\t.msg-content-wrapper {\r\n\t\t\t\t\tflex-direction: row-reverse;\r\n\t\t\t\t\t\r\n\t\t\t\t\t.avatar {\r\n\t\t\t\t\t\tmargin-right: 0;\r\n\t\t\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t.msg-body {\r\n\t\t\t\t\t\talign-items: flex-end;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t.msg-nickname {\r\n\t\t\t\t\t\t\tmargin-right: 10rpx;\r\n\t\t\t\t\t\t\tmargin-left: 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t.msg-bubble {\r\n\t\t\t\t\t\t\tbackground-color: #e0e7ff;\r\n\t\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t.text {\r\n\t\t\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t&::before {\r\n\t\t\t\t\t\t\t\tdisplay: none;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t&::after {\r\n\t\t\t\t\t\t\t\tcontent: '';\r\n\t\t\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\t\t\tright: -10rpx;\r\n\t\t\t\t\t\t\t\ttop: 30rpx;\r\n\t\t\t\t\t\t\t\tborder-top: 10rpx solid transparent;\r\n\t\t\t\t\t\t\t\tborder-bottom: 10rpx solid transparent;\r\n\t\t\t\t\t\t\t\tborder-left: 10rpx solid #e0e7ff;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.input-bar {\r\n\t\tbackground-color: #f7f7f7;\r\n\t\tborder-top: 1rpx solid #ddd;\r\n\t\tpadding: 20rpx 30rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\t\r\n\t\t.input {\r\n\t\t\tflex: 1;\r\n\t\t\tbackground-color: #fff;\r\n\t\t\theight: 72rpx;\r\n\t\t\tborder-radius: 10rpx;\r\n\t\t\tpadding: 0 20rpx;\r\n\t\t\tfont-size: 28rpx;\r\n\t\t}\r\n\t\t\r\n\t\t.send-btn {\r\n\t\t\twidth: 120rpx;\r\n\t\t\theight: 72rpx;\r\n\t\t\tline-height: 72rpx;\r\n\t\t\tbackground: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n\t\t\tcolor: #fff;\r\n\t\t\tfont-size: 26rpx;\r\n\t\t\tmargin-left: 20rpx;\r\n\t\t\tborder-radius: 10rpx;\r\n\t\t\tpadding: 0;\r\n\t\t\t\r\n\t\t\t&[disabled] {\r\n\t\t\t\tbackground-color: #eee;\r\n\t\t\t\tcolor: #999;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'E:/Delivery Service Platform/uniapp/pages/chat/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getUserInfo","get","getToken","API_BASE_URL"],"mappings":"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"}