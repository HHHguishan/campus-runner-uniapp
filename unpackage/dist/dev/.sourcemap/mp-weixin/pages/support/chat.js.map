{"version":3,"file":"chat.js","sources":["pages/support/chat.vue","D:/Users/windows/Downloads/HBuilderX.4.85.2025110510/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3VwcG9ydC9jaGF0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <!-- Âº∫ÂåñÁöÑÁã¨Á´ãÂØºËà™Ê†è -->\r\n    <view class=\"custom-header\">\r\n      <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\r\n      <view class=\"nav-content\">\r\n        <view class=\"back-action\" @tap=\"goBack\">\r\n          <text class=\"cuIcon-back back-icon\"></text>\r\n          <text class=\"back-text\">ËøîÂõû</text>\r\n        </view>\r\n        <view class=\"title-container\">\r\n          <text class=\"header-title\">AI Êô∫ËÉΩ‰ºô‰º¥</text>\r\n        </view>\r\n        <view class=\"right-actions\">\r\n           <view class=\"history-btn\" @tap=\"toggleHistory\" title=\"ÂéÜÂè≤ËÆ∞ÂΩï\">\r\n              <text class=\"cuIcon-list\"></text>\r\n           </view>\r\n           <view class=\"new-chat-btn\" @tap=\"createNewChat\" title=\"ÂºÄÂßãÊñ∞ÂØπËØù\">\r\n              <text class=\"cuIcon-add\"></text>\r\n           </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- ÂéÜÂè≤‰ºöËØùÈÅÆÁΩ©Â±Ç (Drawer) -->\r\n    <view v-if=\"showHistory\" class=\"history-drawer-mask\" @tap=\"showHistory = false\">\r\n      <view class=\"history-drawer\" @tap.stop>\r\n        <view class=\"drawer-header\">\r\n          <text class=\"drawer-title\">ÂÖ®ÈÉ®ÂØπËØùËÆ∞ÂΩï</text>\r\n          <text class=\"cuIcon-close close-icon\" @tap=\"showHistory = false\"></text>\r\n        </view>\r\n        <scroll-view scroll-y class=\"drawer-list\">\r\n          <view v-for=\"(sess, index) in sessionList\" :key=\"index\" \r\n            class=\"session-item\" :class=\"{ active: sess === sessionId }\"\r\n            @tap=\"selectSession(sess)\">\r\n            <view class=\"sess-icon-box\">\r\n              <text class=\"cuIcon-message sess-icon\"></text>\r\n            </view>\r\n            <view class=\"sess-info\">\r\n              <text class=\"sess-id\">{{ sess === 'default' ? 'ÈªòËÆ§‰ºöËØù' : 'ÂØπËØù ' + sess.slice(-6) }}</text>\r\n              <text class=\"sess-time\">{{ sess === 'default' ? 'Á≥ªÁªüÂàùÂßãÂåñ' : 'ÂàõÂª∫‰∫é ' + formatSessionTime(sess) }}</text>\r\n            </view>\r\n          </view>\r\n          <view v-if=\"sessionList.length === 0\" class=\"empty-sessions\">\r\n             <view class=\"cuIcon-info\"></view>\r\n             <text>ÊöÇÊó†ÂéÜÂè≤ÂØπËØù</text>\r\n          </view>\r\n        </scroll-view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- Ê∂àÊÅØÂàóË°® -->\r\n    <scroll-view \r\n      class=\"chat-list\" \r\n      scroll-y \r\n      :scroll-into-view=\"scrollIntoView\" \r\n      scroll-with-animation\r\n      @scrolltoupper=\"loadHistory\"\r\n    >\r\n      <view class=\"message-padding-top\"></view>\r\n      \r\n      <!-- Ê¨¢ËøéËØ≠ -->\r\n      <view class=\"welcome-box animate-slide-up\">\r\n        <view class=\"ai-badge\">Êô∫ËÉΩÊúçÂä°Â∑≤Â∞±Áª™</view>\r\n        <text class=\"welcome-text\">Ê¨¢Ëøé‰ΩøÁî®Ê†°ÂÖâÊô∫ËÉΩÂÆ¢ÊúçÊúçÂä°</text>\r\n      </view>\r\n\r\n      <view v-for=\"(item, index) in messages\" :key=\"index\" :id=\"'msg-' + index\" \r\n        class=\"message-row\" :class=\"[item.role, 'animate-fade-in']\">\r\n        \r\n        <view class=\"avatar-box\">\r\n          <image :src=\"item.role === 'ai' ? '/static/ai-avatar.png' : userInfo.avatar\" mode=\"aspectFill\" class=\"avatar-img\"></image>\r\n          <view v-if=\"item.role === 'ai'\" class=\"online-tag\"></view>\r\n        </view>\r\n\r\n        <view class=\"content-wrapper\">\r\n          <view class=\"nickname\">{{ item.role === 'ai' ? 'Êô∫ËÉΩÂÆ¢Êúç ¬∑ Ê≠£Âú®ËøêË°å' : 'ÊàëÁöÑÂí®ËØ¢' }}</view>\r\n          <view class=\"bubble\" :class=\"item.role\">\r\n            <view class=\"message-text\">\r\n              <text v-if=\"item.role === 'ai' && !item.content\" class=\"typing-placeholder\">Ê≠£Âú®Ê∑±Â∫¶ÊÄùËÄÉ‰∏≠...</text>\r\n              <text v-else selectable>{{ item.content }}</text>\r\n            </view>\r\n            <!-- Ê∞îÊ≥°ÊäïÂΩ±Ë£ÖÈ•∞ -->\r\n            <view class=\"bubble-shadow\"></view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      \r\n      <view class=\"message-padding-bottom\" id=\"bottom\"></view>\r\n    </scroll-view>\r\n\r\n    <!-- ÊÇ¨ÊµÆÂºèËæìÂÖ•Âå∫Âüü -->\r\n    <view class=\"floating-input-area\" :style=\"{ bottom: keyboardHeight + 'px' }\">\r\n      <view class=\"input-card shadow-premium\">\r\n        <!-- Áä∂ÊÄÅÊåáÁ§∫ÁÅØ -->\r\n        <view class=\"status-dot\" :class=\"{ 'is-loading': loading }\"></view>\r\n        \r\n        <input \r\n          class=\"premium-input\" \r\n          type=\"text\" \r\n          v-model=\"inputMsg\" \r\n          placeholder=\"ÈóÆÈóÆÊàëÔºöÊàëÁöÑËÆ¢ÂçïÂà∞Âì™‰∫ÜÔºü\" \r\n          placeholder-class=\"input-placeholder\"\r\n          @confirm=\"sendMessage\"\r\n          :confirm-hold=\"true\"\r\n        />\r\n        \r\n        <view class=\"action-buttons\">\r\n          <view class=\"clear-btn\" @tap=\"confirmClear\" title=\"Ê∏ÖÁ©∫ÂØπËØù\">\r\n            <text class=\"cuIcon-delete\"></text>\r\n          </view>\r\n          <button class=\"send-btn-v2\" :class=\"{ 'active': inputMsg.trim() }\" @tap=\"sendMessage\" :disabled=\"loading\">\r\n            <view class=\"send-icon-box\" v-if=\"!loading\">\r\n               <text class=\"cuIcon-forwardfill\"></text>\r\n            </view>\r\n            <view class=\"loading-icon\" v-else></view>\r\n          </button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { getAiChatStream, clearAiHistory, getAiChatHistory, getAiChatSessions } from '@/api/ai'\r\nimport { getUserInfo } from '@/utils/token'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      userInfo: {},\r\n      inputMsg: '',\r\n      messages: [\r\n        { \r\n          role: 'ai', \r\n          content: 'ÊÇ®Â•ΩÔºÅÊàëÊòØÊÇ®ÁöÑÊô∫ËÉΩÊ†°ÂÖâÂä©Êâã„ÄÇüåª\\nÊàëÂèØ‰ª•Â∏ÆÊÇ®Êü•ËØ¢ËÆ¢Âçï„ÄÅÊ†∏ÂØπ‰ΩôÈ¢ùÔºåÊàñËÄÖËß£Á≠î‰ªª‰ΩïÊ†°Âõ≠ÊúçÂä°ÈóÆÈ¢ò„ÄÇÊúâ‰ªÄ‰πàÊàëÂèØ‰ª•Â∏ÆÊÇ®ÁöÑÂêóÔºü' \r\n        }\r\n      ],\r\n      loading: false,\r\n      scrollIntoView: '',\r\n      keyboardHeight: 0,\r\n      statusBarHeight: 0,\r\n      sessionId: 'default', // ÂΩìÂâç‰ºöËØù ID\r\n      showHistory: false,   // ÊòØÂê¶ÊòæÁ§∫ÂéÜÂè≤ÂàóË°®\r\n      sessionList: []       // ÂéÜÂè≤‰ºöËØùÂàóË°®\r\n    }\r\n  },\r\n  onLoad() {\r\n    this.userInfo = getUserInfo() || {}\r\n    // ÊåÅ‰πÖÂåñËé∑Âèñ sessionIdÔºåËß£ÂÜ≥‚ÄúËøõÂÖ•Âç≥ default‚ÄùÁöÑÈóÆÈ¢ò\r\n    this.sessionId = uni.getStorageSync('ai_chat_session_id') || 'default'\r\n    \r\n    // Ëé∑ÂèñÂéÜÂè≤ËÆ∞ÂΩï\r\n    this.loadChatHistory()\r\n    \r\n    // Ëé∑ÂèñÁä∂ÊÄÅÊ†èÈ´òÂ∫¶\r\n    const systemInfo = uni.getSystemInfoSync()\r\n    this.statusBarHeight = systemInfo.statusBarHeight\r\n    \r\n    uni.onKeyboardHeightChange(res => {\r\n      this.keyboardHeight = res.height\r\n      if (res.height > 0) {\r\n        setTimeout(() => this.scrollToBottom(), 100)\r\n      }\r\n    })\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      console.log('üîô ÊâßË°åËøîÂõûÈÄªËæë');\r\n      uni.navigateBack({\r\n        delta: 1,\r\n        fail: () => {\r\n          uni.switchTab({ url: '/pages/mine/mine' })\r\n        }\r\n      });\r\n    },\r\n    toggleHistory() {\r\n      this.showHistory = !this.showHistory\r\n      if (this.showHistory) {\r\n        this.loadSessionList()\r\n      }\r\n    },\r\n    async loadSessionList() {\r\n      try {\r\n        const res = await getAiChatSessions()\r\n        if (res.code === 200) {\r\n          // ÂØπÁªìÊûúËøõË°åËøáÊª§ÂíåÁÆÄÂçïÊéíÂ∫è\r\n          this.sessionList = res.data.sort((a,b) => b > a ? 1 : -1)\r\n        }\r\n      } catch (err) {\r\n        console.error('Ëé∑Âèñ‰ºöËØùÂàóË°®Â§±Ë¥•:', err)\r\n      }\r\n    },\r\n    selectSession(sessId) {\r\n      if (this.sessionId === sessId) {\r\n        this.showHistory = false\r\n        return\r\n      }\r\n      this.sessionId = sessId\r\n      uni.setStorageSync('ai_chat_session_id', sessId)\r\n      this.messages = []\r\n      this.loadChatHistory()\r\n      this.showHistory = false\r\n    },\r\n    formatSessionTime(sessId) {\r\n       if (sessId.startsWith('session_')) {\r\n          const timestamp = parseInt(sessId.split('_')[1])\r\n          return new Date(timestamp).toLocaleString('zh-CN', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })\r\n       }\r\n       return '--'\r\n    },\r\n    scrollToBottom() {\r\n      this.$nextTick(() => {\r\n        this.scrollIntoView = 'bottom'\r\n      })\r\n    },\r\n    async loadChatHistory() {\r\n      try {\r\n        const res = await getAiChatHistory(this.sessionId)\r\n        if (res.data && res.data.length > 0) {\r\n          // Â¶ÇÊûúÊúâÂéÜÂè≤ËÆ∞ÂΩïÔºåÂàôÊõøÊç¢ÂàùÂßãÊ∂àÊÅØ\r\n          this.messages = res.data\r\n        } else {\r\n          // Â¶ÇÊûúÊó†ÂéÜÂè≤ËÆ∞ÂΩïÔºåÊòæÁ§∫Ê¨¢ËøéËØ≠\r\n          this.messages = [\r\n            { \r\n              role: 'ai', \r\n              content: 'ÊÇ®Â•ΩÔºÅÊàëÊòØÊÇ®ÁöÑÊô∫ËÉΩÊ†°ÂÖâÂä©Êâã„ÄÇüåª\\nÊàëÂèØ‰ª•Â∏ÆÊÇ®Êü•ËØ¢ËÆ¢Âçï„ÄÅÊ†∏ÂØπ‰ΩôÈ¢ùÔºåÊàñËÄÖËß£Á≠î‰ªª‰ΩïÊ†°Âõ≠ÊúçÂä°ÈóÆÈ¢ò„ÄÇÊúâ‰ªÄ‰πàÊàëÂèØ‰ª•Â∏ÆÊÇ®ÁöÑÂêóÔºü' \r\n            }\r\n          ]\r\n        }\r\n        this.scrollToBottom()\r\n      } catch (err) {\r\n        console.error('Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•:', err)\r\n      }\r\n    },\r\n    createNewChat() {\r\n      uni.showModal({\r\n        title: 'Êñ∞ÂØπËØù',\r\n        content: 'ÂºÄÂêØ‰∏Ä‰∏™ÂÖ®Êñ∞ÁöÑÂØπËØùÁ™óÂè£ÂêóÔºü‰πãÂâçÂØπËØù‰ªç‰ºö‰øùÂ≠òÂú®ÂéÜÂè≤‰∏≠„ÄÇ',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            const newSessionId = 'session_' + Date.now()\r\n            this.sessionId = newSessionId\r\n            uni.setStorageSync('ai_chat_session_id', newSessionId)\r\n            \r\n            this.messages = []\r\n            this.loadChatHistory()\r\n            uni.showToast({ title: 'Êñ∞‰ºöËØùÂ∑≤ÂºÄÂêØ', icon: 'none' })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    confirmClear() {\r\n      uni.showModal({\r\n        title: 'ÊèêÁ§∫',\r\n        content: 'Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÂΩìÂâçÁöÑËÅäÂ§©ËÆ∞ÂΩïÂêóÔºü',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            clearAiHistory(this.sessionId).then(() => {\r\n              this.messages = [{ role: 'ai', content: 'ËÆ∞ÂøÜÂ∑≤ÈáçÁΩÆ„ÄÇËØ∑ÈóÆËøòÊúâ‰ªÄ‰πàÊàëÂèØ‰ª•Â∏ÆÊÇ®ÁöÑÔºü' }]\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n    async sendMessage() {\r\n      if (!this.inputMsg.trim() || this.loading) return\r\n      \r\n      const userMsg = this.inputMsg.trim()\r\n      this.inputMsg = ''\r\n      \r\n      this.messages.push({ role: 'user', content: userMsg })\r\n      this.scrollToBottom()\r\n      \r\n      const aiMsgIndex = this.messages.length\r\n      this.messages.push({ role: 'ai', content: '' })\r\n      this.loading = true\r\n      \r\n      let fullContent = ''\r\n      \r\n      getAiChatStream(\r\n        userMsg,\r\n        this.sessionId,\r\n        (token) => {\r\n          // Ê∏ÖÁêÜ SSE ÂçèËÆÆÁöÑ data: ÂâçÁºÄÔºàÈíàÂØπÂ§öË°åÊÉÖÂÜµÔºâ\r\n          let cleanToken = token.replace(/^data:/gm, '').trim();\r\n          \r\n          // Â¢ûÂä† JSON ËøáÊª§Âô®ÔºöÈò≤Ê≠¢ÊòæÁ§∫ÂêéÁ´ØÁöÑ 500 ÂéüÂßã JSON ‰ª£Á†Å\r\n          if (cleanToken.startsWith('{') && cleanToken.includes('\"code\":500')) {\r\n             this.messages[aiMsgIndex].content = 'Êä±Ê≠âÔºåÊàëÁé∞Âú®Êúâ‰∫õÂøôÔºåÊ≠£Âú®Âä™Âäõ‰∏∫ÊÇ®Â§ÑÁêÜ‰∏≠... üê¢'\r\n             this.loading = false\r\n             return\r\n          }\r\n          \r\n          if (cleanToken) {\r\n            fullContent += cleanToken\r\n            this.messages[aiMsgIndex].content = fullContent\r\n            this.scrollToBottom()\r\n          }\r\n        },\r\n        () => {\r\n          this.loading = false\r\n        },\r\n        (err) => {\r\n          this.loading = false\r\n          this.messages[aiMsgIndex].content = 'Êä±Ê≠âÔºåÊàëÁöÑÁΩëÁªúËøûÊé•Á®çÂæÆÊúâ‰∫õÊã•Êå§ÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ'\r\n        }\r\n      )\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.container {\r\n  height: 100vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n  background: linear-gradient(135deg, #f0f7ff 0%, #ffffff 100%);\r\n  position: relative;\r\n}\r\n\r\n/* Áã¨Á´ãÂØºËà™Ê†èÊ†∑Âºè */\r\n.custom-header {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  z-index: 999;\r\n  background: #ffffff;\r\n  border-bottom: 1rpx solid #eeeeee;\r\n  box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n  \r\n  .status-bar { width: 100%; }\r\n  \r\n  .nav-content {\r\n    height: 88rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 0 30rpx;\r\n    justify-content: space-between;\r\n    \r\n    .back-action {\r\n      display: flex;\r\n      align-items: center;\r\n      padding: 10rpx 28rpx;\r\n      color: #fff;\r\n      background: #0081ff; /* Êîπ‰∏∫ÂÆûËâ≤ËÉåÊôØÔºåÊûÅÂÖ∂ÈÜíÁõÆ */\r\n      border-radius: 40rpx;\r\n      box-shadow: 0 4rpx 12rpx rgba(0, 129, 255, 0.3);\r\n      transition: all 0.2s;\r\n      \r\n      .back-icon {\r\n        font-size: 38rpx;\r\n        font-weight: bold;\r\n        margin-right: 6rpx;\r\n      }\r\n      \r\n      .back-text {\r\n        font-size: 28rpx;\r\n        font-weight: bold;\r\n      }\r\n      \r\n      &:active {\r\n        opacity: 0.6;\r\n      }\r\n    }\r\n    \r\n    .title-container {\r\n      position: absolute;\r\n      left: 50%;\r\n      transform: translateX(-50%);\r\n      \r\n      .header-title {\r\n        font-size: 34rpx;\r\n        font-weight: bold;\r\n        color: #1a1a1a;\r\n        letter-spacing: 2rpx;\r\n      }\r\n    }\r\n    \r\n    .empty-side { width: 120rpx; }\r\n    \r\n    .right-actions {\r\n       width: 120rpx;\r\n       display: flex;\r\n       justify-content: flex-end;\r\n       \r\n       .new-chat-btn {\r\n          width: 70rpx;\r\n          height: 70rpx;\r\n          background: #0081ff;\r\n          color: #ffffff;\r\n          border-radius: 50%;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          font-size: 40rpx;\r\n          box-shadow: 0 4rpx 12rpx rgba(0, 129, 255, 0.3);\r\n          \r\n          &:active {\r\n            opacity: 0.6;\r\n            transform: scale(0.9);\r\n          }\r\n       }\r\n    }\r\n  }\r\n}\r\n\r\n.chat-list {\r\n  flex: 1;\r\n  padding: 0 30rpx;\r\n  /* Âä®ÊÄÅÈ¢ÑÁïôÁä∂ÊÄÅÊ†è + ÂØºËà™Ê†èÈ´òÂ∫¶ */\r\n  margin-top: calc(var(--status-bar-height) + 120rpx);\r\n}\r\n\r\n.message-padding-top { height: 30rpx; }\r\n.message-padding-bottom { height: 180rpx; }\r\n\r\n/* Ê¨¢ËøéÁªÑ‰ª∂ */\r\n.welcome-box {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin: 40rpx 0;\r\n  \r\n  .ai-badge {\r\n    padding: 4rpx 16rpx;\r\n    background: rgba(0, 129, 255, 0.1);\r\n    color: #0081ff;\r\n    font-size: 20rpx;\r\n    border-radius: 40rpx;\r\n    margin-bottom: 20rpx;\r\n  }\r\n  \r\n  .welcome-text {\r\n    font-size: 24rpx;\r\n    color: #99aabb;\r\n  }\r\n}\r\n\r\n/* Ê∂àÊÅØË°åÂü∫Á°ÄÁªìÊûÑ */\r\n.message-row {\r\n  display: flex;\r\n  margin-bottom: 50rpx;\r\n  \r\n  .avatar-box {\r\n    width: 84rpx;\r\n    height: 84rpx;\r\n    position: relative;\r\n    flex-shrink: 0;\r\n    \r\n    .avatar-img {\r\n      width: 100%;\r\n      height: 100%;\r\n      border-radius: 24rpx;\r\n      box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.08);\r\n      background: #fff;\r\n    }\r\n    \r\n    .online-tag {\r\n      position: absolute;\r\n      bottom: -4rpx;\r\n      right: -4rpx;\r\n      width: 16rpx;\r\n      height: 16rpx;\r\n      background: #4cd964;\r\n      border: 3rpx solid #fff;\r\n      border-radius: 50%;\r\n    }\r\n  }\r\n  \r\n  .content-wrapper {\r\n    max-width: 75%;\r\n    margin-left: 24rpx;\r\n    \r\n    .nickname {\r\n      font-size: 20rpx;\r\n      color: #aeb6bf;\r\n      margin-bottom: 10rpx;\r\n      padding-left: 4rpx;\r\n    }\r\n    \r\n    .bubble {\r\n      position: relative;\r\n      padding: 24rpx 28rpx;\r\n      font-size: 28rpx;\r\n      line-height: 1.6;\r\n      word-break: break-all;\r\n      \r\n      &.ai {\r\n        background: #ffffff;\r\n        color: #2c3e50;\r\n        border-radius: 4rpx 32rpx 32rpx 32rpx;\r\n        box-shadow: 0 10rpx 30rpx rgba(0,0,0,0.04);\r\n        border: 1rpx solid #f0f3f6;\r\n        \r\n        .message-text { color: #2c3e50; }\r\n      }\r\n      \r\n      &.user {\r\n        background: #0081ff;\r\n        color: #fff;\r\n        border-radius: 32rpx 4rpx 32rpx 32rpx;\r\n        box-shadow: 0 10rpx 20rpx rgba(0,129,255,0.15);\r\n        \r\n        .message-text { color: #fff; }\r\n      }\r\n      \r\n      .typing-placeholder {\r\n        color: #999;\r\n        font-style: italic;\r\n      }\r\n    }\r\n  }\r\n  \r\n  &.user {\r\n    flex-direction: row-reverse;\r\n    .content-wrapper {\r\n      margin-left: 0;\r\n      margin-right: 24rpx;\r\n      text-align: right;\r\n    }\r\n  }\r\n}\r\n\r\n/* ÊãüÊÄÅËæìÂÖ•Âå∫ */\r\n.floating-input-area {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  padding: 30rpx;\r\n  background: transparent;\r\n  pointer-events: none; /* ËÆ©Â§ñÈÉ®ÂèØ‰ª•Á©øÈÄèÔºå‰ΩÜÂÜÖÈÉ® card Ë¶ÅÊîπÂõû auto */\r\n  \r\n  .input-card {\r\n    pointer-events: auto;\r\n    background: rgba(255, 255, 255, 0.95);\r\n    backdrop-filter: blur(10px);\r\n    border-radius: 50rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 10rpx 10rpx 10rpx 36rpx;\r\n    border: 1rpx solid rgba(0,0,0,0.03);\r\n    \r\n    .status-dot {\r\n      width: 12rpx;\r\n      height: 12rpx;\r\n      background: #4cd964;\r\n      border-radius: 50%;\r\n      margin-right: 20rpx;\r\n      box-shadow: 0 0 10rpx rgba(76,217,100,0.5);\r\n      \r\n      &.is-loading {\r\n        background: #0081ff;\r\n        animation: pulse 1.5s infinite;\r\n      }\r\n    }\r\n    \r\n    .premium-input {\r\n      flex: 1;\r\n      height: 80rpx;\r\n      font-size: 28rpx;\r\n      color: #333;\r\n    }\r\n    \r\n    .input-placeholder { color: #bdc3c7; }\r\n    \r\n    .action-buttons {\r\n      display: flex;\r\n      align-items: center;\r\n      \r\n      .clear-btn {\r\n        padding: 20rpx;\r\n        color: #99aabb;\r\n        font-size: 32rpx;\r\n      }\r\n      \r\n      .send-btn-v2 {\r\n        width: 80rpx;\r\n        height: 80rpx;\r\n        border-radius: 50%;\r\n        background: #f4f6f7;\r\n        padding: 0;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        transition: all 0.3s;\r\n        box-shadow: inset 0 2rpx 6rpx rgba(0,0,0,0.05);\r\n        color: #bdc3c7;\r\n        \r\n        &::after { border: none; }\r\n        \r\n        &.active {\r\n          background: #0081ff;\r\n          color: #fff;\r\n          box-shadow: 0 6rpx 16rpx rgba(0,129,255,0.3);\r\n          transform: scale(1.05);\r\n        }\r\n        \r\n        .loading-icon {\r\n          width: 30rpx;\r\n          height: 30rpx;\r\n          border: 3rpx solid #fff;\r\n          border-top-color: transparent;\r\n          border-radius: 50%;\r\n          animation: spin 0.8s linear infinite;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/* Èò¥ÂΩ±ËæÖÂä© */\r\n.shadow-premium {\r\n  box-shadow: 0 20rpx 60rpx rgba(0,0,0,0.1) !important;\r\n}\r\n\r\n/* Âä®ÁîªÂÆö‰πâ */\r\n@keyframes pulse {\r\n  0% { transform: scale(1); opacity: 0.8; }\r\n  50% { transform: scale(1.4); opacity: 1; box-shadow: 0 0 20rpx rgba(0,129,255,0.6); }\r\n  100% { transform: scale(1); opacity: 0.8; }\r\n}\r\n\r\n@keyframes spin {\r\n  to { transform: rotate(360deg); }\r\n}\r\n\r\n.animate-fade-in {\r\n  animation: fadeIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;\r\n}\r\n\r\n.animate-slide-up {\r\n  animation: slideUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;\r\n}\r\n\r\n@keyframes fadeIn {\r\n  0% { opacity: 0; transform: translateY(20rpx) scale(0.98); }\r\n  100% { opacity: 1; transform: translateY(0) scale(1); }\r\n}\r\n\r\n@keyframes slideUp {\r\n  0% { opacity: 0; transform: translateY(40rpx); }\r\n  100% { opacity: 1; transform: translateY(0); }\r\n}\r\n\r\n/* ÂéÜÂè≤ËÆ∞ÂΩïÊåâÈíÆÊ†∑Âºè */\r\n.history-btn {\r\n  width: 70rpx;\r\n  height: 70rpx;\r\n  background: rgba(0, 129, 255, 0.1);\r\n  color: #0081ff;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 36rpx;\r\n  margin-right: 20rpx;\r\n  transition: all 0.2s;\r\n  \r\n  &:active {\r\n    opacity: 0.6;\r\n    transform: scale(0.9);\r\n  }\r\n}\r\n\r\n/* ÂéÜÂè≤ËÆ∞ÂΩï‰æßËæπÊäΩÂ±â */\r\n.history-drawer-mask {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.4);\r\n  backdrop-filter: blur(5px);\r\n  z-index: 2000;\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  animation: fadeIn 0.3s;\r\n}\r\n\r\n.history-drawer {\r\n  width: 520rpx;\r\n  height: 100%;\r\n  background: #ffffff;\r\n  box-shadow: -10rpx 0 30rpx rgba(0,0,0,0.1);\r\n  display: flex;\r\n  flex-direction: column;\r\n  animation: slideInRight 0.3s ease-out;\r\n  \r\n  .drawer-header {\r\n    padding: 100rpx 40rpx 40rpx;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    border-bottom: 1rpx solid #f5f5f5;\r\n    \r\n    .drawer-title {\r\n      font-size: 36rpx;\r\n      font-weight: bold;\r\n      color: #333;\r\n    }\r\n    \r\n    .close-icon {\r\n      font-size: 40rpx;\r\n      color: #999;\r\n      padding: 10rpx;\r\n    }\r\n  }\r\n  \r\n  .drawer-list {\r\n    flex: 1;\r\n    padding: 20rpx;\r\n    \r\n    .session-item {\r\n      padding: 30rpx 20rpx;\r\n      display: flex;\r\n      align-items: center;\r\n      border-radius: 16rpx;\r\n      margin-bottom: 16rpx;\r\n      transition: all 0.2s;\r\n      border: 2rpx solid transparent;\r\n      \r\n      &.active {\r\n        background: rgba(0, 129, 255, 0.05);\r\n        border: 2rpx solid rgba(0, 129, 255, 0.15);\r\n        \r\n        .sess-icon-box {\r\n          background: #0081ff;\r\n          color: #fff;\r\n        }\r\n        \r\n        .sess-id {\r\n          color: #0081ff;\r\n          font-weight: bold;\r\n        }\r\n      }\r\n      \r\n      &:active {\r\n        opacity: 0.7;\r\n        background: #f9f9f9;\r\n        transform: scale(0.98);\r\n      }\r\n      \r\n      .sess-icon-box {\r\n        width: 80rpx;\r\n        height: 80rpx;\r\n        background: #f0f3f6;\r\n        color: #7f8c8d;\r\n        border-radius: 16rpx;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-right: 24rpx;\r\n        font-size: 38rpx;\r\n      }\r\n      \r\n      .sess-info {\r\n        flex: 1;\r\n        display: flex;\r\n        flex-direction: column;\r\n        \r\n        .sess-id {\r\n          font-size: 28rpx;\r\n          color: #2c3e50;\r\n          margin-bottom: 8rpx;\r\n        }\r\n        \r\n        .sess-time {\r\n          font-size: 22rpx;\r\n          color: #95a5a6;\r\n        }\r\n      }\r\n    }\r\n    \r\n    .empty-sessions {\r\n      padding: 120rpx 0;\r\n      text-align: center;\r\n      color: #bdc3c7;\r\n      \r\n      .cuIcon-info {\r\n        font-size: 80rpx;\r\n        margin-bottom: 30rpx;\r\n        opacity: 0.5;\r\n      }\r\n      \r\n      text { font-size: 26rpx; }\r\n    }\r\n  }\r\n}\r\n\r\n@keyframes slideInRight {\r\n  from { transform: translateX(100%); }\r\n  to { transform: translateX(0); }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/Delivery Service Platform/uniapp/pages/support/chat.vue'\nwx.createPage(MiniProgramPage)"],"names":["getUserInfo","uni","getAiChatSessions","getAiChatHistory","clearAiHistory","getAiChatStream"],"mappings":"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"}